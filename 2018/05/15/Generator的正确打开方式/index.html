<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  
  
  
  
  <title>Generator的正确打开方式 - Jarvis&#39;s Blog</title>
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 7.3.0"><link rel="stylesheet" href="/css/prism-coy.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"><script src="/js/prism.js"></script>
<script src="/js/prism-line-numbers.min.js"></script></head>


  <body class="fixed">
    <div class="container">
      <header class="header">
  <div class="blog-title">
    <a href="/" class="logo">Jarvis&#39;s Blog</a>
  </div>
  <nav class="navbar">
    <ul class="menu">
      
        <li class="menu-item">
          <a href="/" class="menu-item-link menu-item-home">Home</a>
        </li>
      
        <li class="menu-item">
          <a href="/about" class="menu-item-link menu-item-about">About</a>
        </li>
      
        <li class="menu-item">
          <a href="/contact" class="menu-item-link menu-item-contact">Contact</a>
        </li>
      
        <li class="menu-item">
          <a href="/links" class="menu-item-link menu-item-friends">Friends</a>
        </li>
      
        <li class="menu-item">
          <a href="https://github.com/jiasm" class="menu-item-link menu-item-github">Github</a>
        </li>
      
    </ul>
  </nav>
</header>

        <main class="main">
          
  <input type="checkbox" id="toggle-toc" class="toggle-toc-right" />
  <div class="toc-toggle toc-toggle-right">
    <label for="toggle-toc">
      <i class="fa fa-list-ol"></i>
    </label>
    <div class="toc-wrap toc-wrap-right">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Generator%E7%9A%84%E8%AF%AD%E6%B3%95"><span class="toc-number">1.</span> <span class="toc-text">Generator的语法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#generator%E7%9A%84%E5%88%9D%E5%A7%8B%E5%8C%96%E4%B8%8E%E5%A4%8D%E7%94%A8"><span class="toc-number">1.1.</span> <span class="toc-text">generator的初始化与复用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Method-next"><span class="toc-number">1.2.</span> <span class="toc-text">Method: next()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%9C%E4%B8%BA%E8%BF%AD%E4%BB%A3%E5%99%A8%E4%BD%BF%E7%94%A8"><span class="toc-number">1.3.</span> <span class="toc-text">作为迭代器使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Method-return"><span class="toc-number">1.4.</span> <span class="toc-text">Method: return()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Method-throw"><span class="toc-number">1.5.</span> <span class="toc-text">Method: throw()</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Yield%E7%9A%84%E8%AF%AD%E6%B3%95"><span class="toc-number">2.</span> <span class="toc-text">Yield的语法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%80%8Cyield%E7%9A%84%E8%A1%A8%E7%8E%B0%E5%88%99%E4%B8%8D%E4%B8%80%E6%A0%B7"><span class="toc-number">2.1.</span> <span class="toc-text">而yield的表现则不一样</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#yield"><span class="toc-number">2.2.</span> <span class="toc-text">yield*</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#yield%E7%9A%84%E8%BF%94%E5%9B%9E%E5%80%BC"><span class="toc-number">2.3.</span> <span class="toc-text">yield的返回值</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E4%BA%9B%E5%AE%9E%E9%99%85%E7%9A%84%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">3.</span> <span class="toc-text">一些实际的使用场景</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E9%9A%8F%E6%9C%BA%E6%95%B0%E7%94%9F%E6%88%90"><span class="toc-number">3.1.</span> <span class="toc-text">一个简单的随机数生成</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E6%9B%BF%E4%B8%80%E4%BA%9B%E9%80%92%E5%BD%92%E7%9A%84%E6%93%8D%E4%BD%9C"><span class="toc-number">3.2.</span> <span class="toc-text">代替一些递归的操作</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%8Easync-await%E7%9A%84%E7%BB%93%E5%90%88"><span class="toc-number">4.</span> <span class="toc-text">与async&#x2F;await的结合</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%8F%E8%AE%B0"><span class="toc-number">5.</span> <span class="toc-text">小记</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="toc-number">6.</span> <span class="toc-text">参考资料</span></a></li></ol>
    </div>
  </div>
  <label class="mask" for="toggle-toc"></label>

<div id="post-content">
  <h1>Generator的正确打开方式</h1>
  <blockquote>
<p>前两年大量的在写<code>Generator</code>+<code>co</code>，用它来写一些类似同步的代码<br>但实际上，<code>Generator</code>并不是被造出来干这个使的，不然也就不会有后来的<code>async</code>、<code>await</code>了<br><code>Generator</code>是一个可以被暂停的函数，并且何时恢复，由调用方决定<br>希望本文可以帮助你理解<code>Generator</code>究竟是什么，以及怎么用  </p>
</blockquote>
<span id="more"></span>

<p>放一张图来表示我对<code>Generator</code>的理解：<br><img src="/images/understanding-generators/banner.jpeg"><br><em>一个咖啡机，虽说我并不喝咖啡，可惜找不到造王老吉的机器-.-</em></p>
<p>我所理解的<del>Generator</del>咖啡机大概就是这么的一个样子的：</p>
<ol>
<li>首先，我们往机器里边放一些咖啡豆</li>
<li>等我们想喝咖啡的时候，就可以按开关(<code>gen.next()</code>)，机器开始磨咖啡豆、煮咖啡、接下来就得到咖啡了</li>
<li>等接满了一杯咖啡后，阀门就会自动关闭(<code>yield</code>)</li>
<li>如果你一开始往机器里边放的咖啡豆很多的话，此时，机器里边还是会有一些剩余的，下次再想喝还可以继续按开关，执行（磨豆、煮咖啡、接咖啡）这一套操作</li>
</ol>
<p>拿<code>Generator</code>将上述咖啡机实现一下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> * <span class="title function_">coffeeMachineGenerator</span> (beans) &#123;</span><br><span class="line">  <span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="keyword">yield</span> <span class="title function_">cookCoffee</span>()</span><br><span class="line">  &#125; <span class="keyword">while</span> (--beans)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 煮咖啡</span></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">cookCoffee</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;cooking&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Here you are&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 往咖啡机放咖啡豆</span></span><br><span class="line"><span class="keyword">let</span> coffeeMachine = <span class="title function_">coffeeMachineGenerator</span>(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 我想喝咖啡了</span></span><br><span class="line">coffeeMachine.<span class="title function_">next</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 我在3秒后还会喝咖啡</span></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  coffeeMachine.<span class="title function_">next</span>()</span><br><span class="line">&#125;, <span class="number">3</span> * <span class="number">1e3</span>)</span><br></pre></td></tr></table></figure>

<p>代码运行后，我们首先会得到一条<code>cooking</code>的<code>log</code>，<br>然后在<code>3s</code>后会再次得到一条<code>log</code>。  </p>
<p>这就解释了<code>Generator</code>是什么：<br>一个可以暂停的迭代器<br>调用<code>next</code>来获取数据（<em>我们自己来决定是否何时煮咖啡</em>）<br>在遇到<code>yield</code>以后函数的执行就会停止（<em>接满了一杯，阀门关闭</em>）<br>我们来决定何时运行剩余的代码<code>next</code>（<em>什么时候想喝了再去煮</em>）  </p>
<p><strong>这是<code>Generator</code>中最重要的特性，我们只有在真正需要的时候才获取下一个值，而不是一次性获取所有的值</strong></p>
<h2 id="Generator的语法"><a href="#Generator的语法" class="headerlink" title="Generator的语法"></a>Generator的语法</h2><p>声明<code>Generator</code>函数有很多种途径，最重要的一点就是，在<code>function</code>关键字后添加一个<code>*</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> * <span class="title function_">generator</span> () &#123;&#125;</span><br><span class="line"><span class="keyword">function</span>* <span class="title function_">generator</span> () &#123;&#125;</span><br><span class="line"><span class="keyword">function</span> *<span class="title function_">generator</span> () &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> generator = <span class="keyword">function</span> * () &#123;&#125;</span><br><span class="line"><span class="keyword">let</span> generator = <span class="keyword">function</span>*  () &#123;&#125;</span><br><span class="line"><span class="keyword">let</span> generator = <span class="keyword">function</span>  *() &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 错误的示例</span></span><br><span class="line"><span class="keyword">let</span> generator = *<span class="function">() =&gt;</span> &#123;&#125;</span><br><span class="line"><span class="keyword">let</span> generator = ()* =&gt; &#123;&#125;</span><br><span class="line"><span class="keyword">let</span> <span class="title function_">generator</span> = (<span class="params">*</span>) =&gt; &#123;&#125;</span><br></pre></td></tr></table></figure>

<p>或者，因为是一个函数，也可以作为一个对象的属性来存在：  </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyClass</span> &#123;</span><br><span class="line">  * <span class="title function_">generator</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line">  *<span class="title function_">generator2</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  *<span class="title function_">generator</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line">  * <span class="title function_">generator</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="generator的初始化与复用"><a href="#generator的初始化与复用" class="headerlink" title="generator的初始化与复用"></a>generator的初始化与复用</h3><p>一个<code>Generator</code>函数通过调用两次方法，将会生成两个完全独立的<code>状态机</code><br>所以，保存当前的<code>Generator</code>对象很重要：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> * <span class="title function_">generator</span> (name = <span class="string">&#x27;unknown&#x27;</span>) &#123;</span><br><span class="line">  <span class="keyword">yield</span> <span class="string">`Your name: <span class="subst">$&#123;name&#125;</span>`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> gen1 = <span class="title function_">generator</span>()</span><br><span class="line"><span class="keyword">const</span> gen2 = <span class="title function_">generator</span>(<span class="string">&#x27;Niko Bellic&#x27;</span>)</span><br><span class="line"></span><br><span class="line">gen1.<span class="title function_">next</span>() <span class="comment">// &#123; value: Your name: unknown    , done: false&#125;</span></span><br><span class="line">gen2.<span class="title function_">next</span>() <span class="comment">// &#123; value: Your name: Niko Bellic, done: false&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="Method-next"><a href="#Method-next" class="headerlink" title="Method: next()"></a>Method: next()</h3><p>最常用的<code>next()</code>方法，无论何时调用它，都会得到下一次输出的返回对象（在代码执行完后的调用将会始终返回<code>&#123;value: undefined, done: true&#125;</code>）。  </p>
<p><code>next</code>总会返回一个对象，包含两个属性值：<br><code>value</code>：<code>yield</code>关键字后边表达式的值<br><code>done</code> ：如果已经没有<code>yield</code>关键字了，则会返回<code>true</code> .</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> * <span class="title function_">generator</span> () &#123;</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">5</span></span><br><span class="line">  <span class="keyword">return</span> <span class="number">6</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> gen = <span class="title function_">generator</span>()</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(gen.<span class="title function_">next</span>()) <span class="comment">// &#123;value: 5, done: false&#125;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(gen.<span class="title function_">next</span>()) <span class="comment">// &#123;value: 6, done: true&#125;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(gen.<span class="title function_">next</span>()) <span class="comment">// &#123;value: undefined, done: true&#125;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(gen.<span class="title function_">next</span>()) <span class="comment">// &#123;value: undefined, done: true&#125; -- 后续再调用也都会是这个结果</span></span><br></pre></td></tr></table></figure>

<h3 id="作为迭代器使用"><a href="#作为迭代器使用" class="headerlink" title="作为迭代器使用"></a>作为迭代器使用</h3><p><code>Generator</code>函数是一个可迭代的，所以，我们可以直接通过<code>for of</code>来使用它。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> * <span class="title function_">generator</span> () &#123;</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">1</span></span><br><span class="line">  <span class="keyword">yield</span> <span class="number">2</span></span><br><span class="line">  <span class="keyword">return</span> <span class="number">3</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> item <span class="keyword">of</span> <span class="title function_">generator</span>()) &#123;</span><br><span class="line">  item</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1</span></span><br><span class="line"><span class="comment">// 2</span></span><br></pre></td></tr></table></figure>
<p><em><code>return</code>不参与迭代</em><br><em>迭代会执行所有的<code>yield</code>，也就是说，在迭代后的<code>Generator</code>对象将不会再返回任何有效的值</em></p>
<h3 id="Method-return"><a href="#Method-return" class="headerlink" title="Method: return()"></a>Method: return()</h3><p>我们可以在迭代器对象上直接调用<code>return()</code>，来终止后续的代码执行。<br>在<code>return</code>后的所有<code>next()</code>调用都将返回<code>&#123;value: undefined, done: true&#125;</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> * <span class="title function_">generator</span> () &#123;</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">1</span></span><br><span class="line">  <span class="keyword">yield</span> <span class="number">2</span></span><br><span class="line">  <span class="keyword">yield</span> <span class="number">3</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> gen = <span class="title function_">generator</span>()</span><br><span class="line"></span><br><span class="line">gen.<span class="keyword">return</span>()     <span class="comment">// &#123;value: undefined, done: true&#125;</span></span><br><span class="line">gen.<span class="keyword">return</span>(<span class="string">&#x27;hi&#x27;</span>) <span class="comment">// &#123;value: &quot;hi&quot;, done: true&#125;</span></span><br><span class="line">gen.<span class="title function_">next</span>()       <span class="comment">// &#123;value: undefined, done: true&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="Method-throw"><a href="#Method-throw" class="headerlink" title="Method: throw()"></a>Method: throw()</h3><p>在调用<code>throw()</code>后同样会终止所有的<code>yield</code>执行，同时会抛出一个异常，需要通过<code>try-catch</code>来接收：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> * <span class="title function_">generator</span> () &#123;</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">1</span></span><br><span class="line">  <span class="keyword">yield</span> <span class="number">2</span></span><br><span class="line">  <span class="keyword">yield</span> <span class="number">3</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> gen = <span class="title function_">generator</span>()</span><br><span class="line"></span><br><span class="line">gen.<span class="keyword">throw</span>(<span class="string">&#x27;error text&#x27;</span>) <span class="comment">// Error: error text</span></span><br><span class="line">gen.<span class="title function_">next</span>()              <span class="comment">// &#123;value: undefined, done: true&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="Yield的语法"><a href="#Yield的语法" class="headerlink" title="Yield的语法"></a>Yield的语法</h2><p><code>yield</code>的语法有点像<code>return</code>，但是，<code>return</code>是在函数调用结束后返回结果的<br>并且在调用<code>return</code>之后不会执行其他任何的操作</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">method</span> (<span class="params">a</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> b = <span class="number">5</span></span><br><span class="line">  <span class="keyword">return</span> a + b</span><br><span class="line">  <span class="comment">// 下边的两句代码永远不会执行</span></span><br><span class="line">  b = <span class="number">6</span></span><br><span class="line">  <span class="keyword">return</span> a * b</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">method</span>(<span class="number">6</span>) <span class="comment">// 11</span></span><br><span class="line"><span class="title function_">method</span>(<span class="number">6</span>) <span class="comment">// 11</span></span><br></pre></td></tr></table></figure>

<h3 id="而yield的表现则不一样"><a href="#而yield的表现则不一样" class="headerlink" title="而yield的表现则不一样"></a>而yield的表现则不一样</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> * <span class="title function_">yieldMethod</span>(<span class="params">a</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> b = <span class="number">5</span></span><br><span class="line">  <span class="keyword">yield</span> a + b</span><br><span class="line">  <span class="comment">// 在执行第二次`next`时，下边两行则会执行</span></span><br><span class="line">  b = <span class="number">6</span></span><br><span class="line">  <span class="keyword">return</span> a * b</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> gen = <span class="title function_">yieldMethod</span>(<span class="number">6</span>)</span><br><span class="line">gen.<span class="title function_">next</span>().<span class="property">value</span> <span class="comment">// 11</span></span><br><span class="line">gen.<span class="title function_">next</span>().<span class="property">value</span> <span class="comment">// 36</span></span><br></pre></td></tr></table></figure>

<h3 id="yield"><a href="#yield" class="headerlink" title="yield*"></a>yield*</h3><p><code>yield*</code>用来将一个<code>Generator</code>放到另一个<code>Generator</code>函数中执行。<br>有点像<code>[...]</code>的功能：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> * <span class="title function_">gen1</span> () &#123;</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">2</span></span><br><span class="line">  <span class="keyword">yield</span> <span class="number">3</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> * <span class="title function_">gen2</span> () &#123;</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">1</span></span><br><span class="line">  <span class="keyword">yield</span> * <span class="title function_">gen1</span>()</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">4</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> gen = <span class="title function_">gen2</span>()</span><br><span class="line"></span><br><span class="line">gen.<span class="title function_">next</span>().<span class="property">value</span> <span class="comment">// 1</span></span><br><span class="line">gen.<span class="title function_">next</span>().<span class="property">value</span> <span class="comment">// 2</span></span><br><span class="line">gen.<span class="title function_">next</span>().<span class="property">value</span> <span class="comment">// 3</span></span><br><span class="line">gen.<span class="title function_">next</span>().<span class="property">value</span> <span class="comment">// 4</span></span><br></pre></td></tr></table></figure>

<h3 id="yield的返回值"><a href="#yield的返回值" class="headerlink" title="yield的返回值"></a>yield的返回值</h3><p><code>yield</code>是可以接收返回值的，返回值可以在后续的代码被使用<br><em>一个诡异的写法</em></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> * <span class="title function_">generator</span> (num) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">yield</span> <span class="keyword">yield</span> num</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> gen = <span class="title function_">generator</span>(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(gen.<span class="title function_">next</span>())  <span class="comment">// &#123;value: 1, done: false&#125;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(gen.<span class="title function_">next</span>(<span class="number">2</span>)) <span class="comment">// &#123;value: 2, done: false&#125;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(gen.<span class="title function_">next</span>(<span class="number">3</span>)) <span class="comment">// &#123;value: 3, done: true &#125;</span></span><br></pre></td></tr></table></figure>

<p>我们在调用第一次<code>next</code>时候，代码执行到了<code>yield num</code>，此时返回<code>num</code><br>然后我们再调用<code>next(2)</code>，代码执行的是<code>yield (yield num)</code>，而其中返回的值就是我们在<code>next</code>中传入的参数了，作为<code>yield num</code>的返回值存在。<br>以及最后的<code>next(3)</code>，执行的是这部分代码<code>return (yield (yield num))</code>，第二次<code>yield</code>表达式的返回值。  </p>
<h2 id="一些实际的使用场景"><a href="#一些实际的使用场景" class="headerlink" title="一些实际的使用场景"></a>一些实际的使用场景</h2><p>上边的所有示例都是建立在已知次数的<code>Generator</code>函数上的，但如果你需要一个未知次数的<code>Generator</code>，仅需要创建一个无限循环就够了。  </p>
<h3 id="一个简单的随机数生成"><a href="#一个简单的随机数生成" class="headerlink" title="一个简单的随机数生成"></a>一个简单的随机数生成</h3><p>比如我们将实现一个随机数的获取：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> * <span class="title function_">randomGenerator</span> (...randoms) &#123;</span><br><span class="line">  <span class="keyword">let</span> len = randoms.<span class="property">length</span></span><br><span class="line">  <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">    <span class="keyword">yield</span> randoms[<span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * len)]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> randomeGen = <span class="title function_">randomGenerator</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">randomeGen.<span class="title function_">next</span>().<span class="property">value</span> <span class="comment">// 返回一个随机数</span></span><br></pre></td></tr></table></figure>

<h3 id="代替一些递归的操作"><a href="#代替一些递归的操作" class="headerlink" title="代替一些递归的操作"></a>代替一些递归的操作</h3><p>那个最著名的<em>斐波那契数</em>，基本上都会选择使用递归来实现<br>但是再结合着<code>Generator</code>以后，就可以使用一个无限循环来实现了：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> * <span class="title function_">fibonacci</span>(<span class="params">seed1, seed2</span>) &#123;</span><br><span class="line">  <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">    <span class="title function_">yield</span> (<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      seed2 = seed2 + seed1;</span><br><span class="line">      seed1 = seed2 - seed1;</span><br><span class="line">      <span class="keyword">return</span> seed2;</span><br><span class="line">    &#125;)();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> fib = <span class="title function_">fibonacci</span>(<span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">fib.<span class="title function_">next</span>(); <span class="comment">// &#123;value: 1, done: false&#125;</span></span><br><span class="line">fib.<span class="title function_">next</span>(); <span class="comment">// &#123;value: 2, done: false&#125;</span></span><br><span class="line">fib.<span class="title function_">next</span>(); <span class="comment">// &#123;value: 3, done: false&#125;</span></span><br><span class="line">fib.<span class="title function_">next</span>(); <span class="comment">// &#123;value: 5, done: false&#125;</span></span><br><span class="line">fib.<span class="title function_">next</span>(); <span class="comment">// &#123;value: 8, done: false&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="与async-await的结合"><a href="#与async-await的结合" class="headerlink" title="与async&#x2F;await的结合"></a>与async&#x2F;await的结合</h2><blockquote>
<p>再次重申，我个人不认为async&#x2F;await是Generator的语法糖。。  </p>
</blockquote>
<p>如果是写前端的童鞋，基本上都会遇到处理分页加载数据的时候<br>如果结合着<code>Generator</code>+<code>async</code>、<code>await</code>，我们可以这样实现：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> * <span class="title function_">loadDataGenerator</span> (url) &#123;</span><br><span class="line">  <span class="keyword">let</span> page = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">    page = (<span class="keyword">yield</span> <span class="keyword">await</span> <span class="title function_">ajax</span>(url, &#123;</span><br><span class="line">      <span class="attr">data</span>: page</span><br><span class="line">    &#125;)) || ++page</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用setTimeout模拟异步请求</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">ajax</span> (<span class="params">url, &#123; data: page &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function"><span class="params">_</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`get page: <span class="subst">$&#123;page&#125;</span>`</span>);</span><br><span class="line">      <span class="title function_">resolve</span>()</span><br><span class="line">    &#125;, <span class="number">1000</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> loadData = <span class="title function_">loadDataGenerator</span>(<span class="string">&#x27;get-data-url&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">await</span> loadData.<span class="title function_">next</span>()</span><br><span class="line"><span class="keyword">await</span> loadData.<span class="title function_">next</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">// force load page 1</span></span><br><span class="line"><span class="keyword">await</span> loadData.<span class="title function_">next</span>(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">await</span> loadData.<span class="title function_">next</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">// get page: 1</span></span><br><span class="line"><span class="comment">// get page: 2</span></span><br><span class="line"><span class="comment">// get page: 1</span></span><br><span class="line"><span class="comment">// get page: 2</span></span><br></pre></td></tr></table></figure>

<p>这样我们可以在简单的几行代码中实现一个分页控制函数了。<br>如果想要从加载特定的页码，直接将<code>page</code>传入<code>next</code>即可。</p>
<h2 id="小记"><a href="#小记" class="headerlink" title="小记"></a>小记</h2><p><code>Generator</code>还有更多的使用方式，（实现异步流程控制、按需进行数据读取）<br>个人认为，<code>Generator</code>的优势在于代码的惰性执行，<code>Generator</code>所实现的事情，我们不使用它也可以做到，只是使用<code>Generator</code>后，能够让代码的可读性变得更好、流程变得更清晰、更专注于逻辑的实现。</p>
<blockquote>
<p>如果有什么不懂的地方 or 文章中一些的错误，欢迎指出</p>
</blockquote>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ol>
<li><a href="https://medium.com/@hidace/javascript-es6-generators-part-i-understanding-generators-93dea22bf1b">Javascript (ES6) Generators — Part I: Understanding Generators</a></li>
<li><a href="https://codeburst.io/what-are-javascript-generators-and-how-to-use-them-c6f2713fd12e">What are JavaScript Generators and how to use them</a></li>
</ol>
<p><a href="https://github.com/Jiasm/notebook/tree/master/blog-storage/how-to-use-generator">文章示例代码</a></p>

</div>

<section class="comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>
<script>
  var disqus_shortname = 'jiashunming';
  
  var disqus_url = 'http://jiasm.github.io/2018/05/15/Generator%E7%9A%84%E6%AD%A3%E7%A1%AE%E6%89%93%E5%BC%80%E6%96%B9%E5%BC%8F/';
  
  var disqus_config = function () {
    this.page.url = location.href
    this.page.identifier = '8ef40710-582d-11e8-ad45-11152b6d83f2'
    this.page.title = document.querySelector('h1').innerText
  };
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.setAttribute('data-timestamp', +new Date());
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>

<script>
  // I'm not sure your browser supports `es6`
  window.addEventListener('load', function () {
    [].concat(Array.from(document.querySelectorAll('code')), Array.from(document.querySelectorAll('pre'))).filter(function (item) {return item.className.indexOf('language') >= 0}).forEach(function (tag) { tag.classList.add('line-numbers') })
    Prism.highlightAll()

    let scrollY = window.scrollY
    let headersList = Array.from(document.querySelector('#post-content').querySelectorAll('h1,h2,h3,h4,h5,h6')).map(function (item) {
      let rect = item.getBoundingClientRect()
      let anchorTag = document.querySelector(`a.toc-link[href="#${item.id}"]`)

      if (!anchorTag) return
      return {
        top: scrollY + rect.top - rect.height,
        tag: item,
        anchorTag: anchorTag
      }
    }).filter(function (item) { return item })

    window.addEventListener('scroll', debounce(scrollHandler, 200))
    scrollHandler()

    function scrollHandler () {
      let scrollY = window.scrollY
      let minInfo = null

      for (let item of headersList) {
        if (!minInfo) {
          minInfo = item
          continue
        }

        if ((scrollY - item.top) >= 0 && (scrollY - minInfo.top) > (scrollY - item.top)) {
          minInfo = item
        }
      }

      if (minInfo) {
        headersList.forEach(function (item) {
          item.anchorTag && item.anchorTag.classList.remove('selected')
        })
        minInfo.anchorTag.classList.add('selected')
      }
    }

    function debounce (func, delay) {
      let debounceIdentify = 0
      return function () {
        debounceIdentify && clearTimeout(debounceIdentify)
        debounceIdentify = setTimeout(function () {
          debounceIdentify = 0
          func.apply(this, arguments)
        }, delay)
      }
    }
  })
</script>

        </main>
        <a href="#" class="goto-top">
          <i class="fa fa-chevron-up"></i>
        </a>
    </div>
    <footer class="footer">
  <div class="footer-content">
    <div class="footer-info" class="inner">
      <p class="copyright">&copy; 2025 ShunMing Jia<br></p>
      powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
      theme by <a href="https://github.com/Jiasm/hexo-theme-sheet" target="_blank">Sheet</a>
    </div>
    <ul class="contact-info">
      
        <a class="contact-link" href="https://github.com/jiasm" target="_blank"><i class="fa fa-github"></i></a>
      
      
        <a class="contact-link" href="https://weibo.com/jarvis1996" target="_blank"><i class="fa fa-weibo"></i></a>
      
      
        <a class="contact-link" href="https://twitter.com/jiashm" target="_blank"><i class="fa fa-twitter"></i></a>
      
      
        <a class="contact-link" href="https://www.facebook.com/jiashunming" target="_blank"><i class="fa fa-facebook"></i></a>
      
      
        <a class="contact-link" href="mailto:jiashunming@outlook.com" target="_blank"><i class="fa fa-envelope"></i></a>
      
    </ul>
  </div>
</footer>

  <!-- 使用 DISQUS js 代码 -->
  <script id="dsq-count-scr" src="//jiashunming.disqus.com/count.js" async="async"></script>



      <script>
      function footerHandler () {
        if (!window.screen || !document.body) return
        var hasComments = document.querySelector('.comments')
        if ((window.screen.availHeight - (hasComments ? 350 : 0)) > document.body.clientHeight) {
          document.body.classList.add('fixed')
        } else {
          document.body.classList.remove('fixed')
        }
      }
      footerHandler()
      window.addEventListener('resize', footerHandler)
    </script>
  </body>
  <script>
    var pathname = new URL(location.href).pathname.replace(/\/$/, '')

    switch (pathname) {
      case '/about':
        document.querySelector('.menu-item-about').classList.add('active')
        break
      case '/contact':
        document.querySelector('.menu-item-contact').classList.add('active')
        break
      case '/links':
        document.querySelector('.menu-item-friends').classList.add('active')
        break
      default:
        document.querySelector('.menu-item-home').classList.add('active')
    }
  </script>
  
    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?f1f7cb8bfb6de7f6a6277fee35703d98";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
    </script>
    

</html>