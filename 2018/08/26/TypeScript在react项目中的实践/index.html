<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  
  
  
  
  <title>TypeScript在react项目中的实践 - Jarvis&#39;s Blog</title>
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 7.3.0"><link rel="stylesheet" href="/css/prism-coy.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"><script src="/js/prism.js"></script>
<script src="/js/prism-line-numbers.min.js"></script></head>


  <body class="fixed">
    <div class="container">
      <header class="header">
  <div class="blog-title">
    <a href="/" class="logo">Jarvis&#39;s Blog</a>
  </div>
  <nav class="navbar">
    <ul class="menu">
      
        <li class="menu-item">
          <a href="/" class="menu-item-link menu-item-home">Home</a>
        </li>
      
        <li class="menu-item">
          <a href="/about" class="menu-item-link menu-item-about">About</a>
        </li>
      
        <li class="menu-item">
          <a href="/contact" class="menu-item-link menu-item-contact">Contact</a>
        </li>
      
        <li class="menu-item">
          <a href="/links" class="menu-item-link menu-item-friends">Friends</a>
        </li>
      
        <li class="menu-item">
          <a href="https://github.com/jiasm" class="menu-item-link menu-item-github">Github</a>
        </li>
      
    </ul>
  </nav>
</header>

        <main class="main">
          
  <input type="checkbox" id="toggle-toc" class="toggle-toc-right" />
  <div class="toc-toggle toc-toggle-right">
    <label for="toggle-toc">
      <i class="fa fa-list-ol"></i>
    </label>
    <div class="toc-wrap toc-wrap-right">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84"><span class="toc-number">1.</span> <span class="toc-text">项目结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E5%90%8E%E7%AB%AF%E5%A4%8D%E7%94%A8%E4%BB%A3%E7%A0%81%E7%9A%84%E4%B8%80%E4%B8%AA%E5%B0%9D%E8%AF%95"><span class="toc-number">2.</span> <span class="toc-text">前后端复用代码的一个尝试</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E7%9A%84%E6%90%AD%E5%BB%BA"><span class="toc-number">3.</span> <span class="toc-text">环境的搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#webpack%E7%9A%84%E9%85%8D%E7%BD%AE"><span class="toc-number">3.1.</span> <span class="toc-text">webpack的配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#TypeScript%E7%9B%B8%E5%85%B3%E7%9A%84%E9%85%8D%E7%BD%AE"><span class="toc-number">3.2.</span> <span class="toc-text">TypeScript相关的配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ESLint%E7%9A%84%E9%85%8D%E7%BD%AE"><span class="toc-number">3.3.</span> <span class="toc-text">ESLint的配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#node%E5%B1%82%E7%9A%84%E4%BF%AE%E6%94%B9"><span class="toc-number">3.4.</span> <span class="toc-text">node层的修改</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B7%B1%E5%9D%91%EF%BC%8C%E6%B3%A8%E6%84%8F"><span class="toc-number">3.4.1.</span> <span class="toc-text">深坑，注意</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%8F%E7%BB%93"><span class="toc-number">4.</span> <span class="toc-text">小结</span></a></li></ol>
    </div>
  </div>
  <label class="mask" for="toggle-toc"></label>

<div id="post-content">
  <h1>TypeScript在react项目中的实践</h1>
  <p>前段时间有写过一个<a href="/2018/07/21/TypeScript%E5%9C%A8node%E9%A1%B9%E7%9B%AE%E4%B8%AD%E7%9A%84%E5%AE%9E%E8%B7%B5">TypeScript在node项目中的实践</a>。<br>在里边有解释了为什么要使用<code>TS</code>，以及在<code>Node</code>中的一个项目结构是怎样的。<br>但是那仅仅是一个纯接口项目，碰巧赶上近期的另一个项目重构也由我来主持，经过上次的实践以后，尝到了<code>TS</code>所带来的甜头，毫不犹豫的选择用<code>TS</code>+<code>React</code>来重构这个项目。<br>这次的重构不仅包括<code>Node</code>的重构（之前是<code>Express</code>的项目），同时还包括前端的重构（之前是由<code>jQuery</code>驱动的多页应用）。  </p>
<span id="more"></span>

<h2 id="项目结构"><a href="#项目结构" class="headerlink" title="项目结构"></a>项目结构</h2><p>因为目前项目是没有做前后分离的打算的（一个内部工具平台类的项目），所以大致结构就是基于上次<code>Node</code>项目的结构，在其之上添加了一些<code>FrontEnd</code>的目录结构：</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">  .</span><br><span class="line">  ├── README.md</span><br><span class="line">  ├── copy-static-assets.ts</span><br><span class="line">  ├── nodemon.json</span><br><span class="line">  ├── package.json</span><br><span class="line"><span class="addition">+ ├── client-dist</span></span><br><span class="line"><span class="addition">+ │   ├── bundle.js</span></span><br><span class="line"><span class="addition">+ │   ├── bundle.js.map</span></span><br><span class="line"><span class="addition">+ │   ├── logo.png</span></span><br><span class="line"><span class="addition">+ │   └── vendors.dll.js</span></span><br><span class="line">  ├── dist</span><br><span class="line">  ├── src</span><br><span class="line">  │   ├── config</span><br><span class="line">  │   ├── controllers</span><br><span class="line">  │   ├── entity</span><br><span class="line">  │   ├── models</span><br><span class="line">  │   ├── middleware</span><br><span class="line">  │   ├── public</span><br><span class="line">  │   ├── app.ts</span><br><span class="line">  │   ├── server.ts</span><br><span class="line">  │   ├── types</span><br><span class="line"><span class="addition">+ │   ├── common</span></span><br><span class="line">  │   └── utils</span><br><span class="line"><span class="addition">+ ├── client-src</span></span><br><span class="line"><span class="addition">+ │   ├── components</span></span><br><span class="line"><span class="addition">+ │   │   └── Header.tsx</span></span><br><span class="line"><span class="addition">+ │   ├── conf</span></span><br><span class="line"><span class="addition">+ │   │   └── host.ts</span></span><br><span class="line"><span class="addition">+ │   ├── dist</span></span><br><span class="line"><span class="addition">+ │   ├── utils</span></span><br><span class="line"><span class="addition">+ │   ├── index.ejs</span></span><br><span class="line"><span class="addition">+ │   ├── index.tsx</span></span><br><span class="line"><span class="addition">+ │   ├── webpack</span></span><br><span class="line"><span class="addition">+ │   ├── package.json</span></span><br><span class="line"><span class="addition">+ │   └── tsconfig.json</span></span><br><span class="line"><span class="addition">+ ├── views</span></span><br><span class="line"><span class="addition">+ │   └── index.ejs</span></span><br><span class="line">  ├── tsconfig.json</span><br><span class="line">  └── tslint.json</span><br></pre></td></tr></table></figure>

<p>其中标绿（也可能是一个<code>+</code>号显示）的文件为本次新增的。<br>其中<code>client-dist</code>与<code>views</code>都是通过<code>webpack</code>生成的，实际的源码文件都在<code>client-src</code>下。<em>就这个结构拆分前后分离其实没有什么成本</em><br>在下边分了大概这样的一些文件夹：</p>
<table>
<thead>
<tr>
<th align="center">dir&#x2F;file</th>
<th align="left">desc</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><code>index.ejs</code></td>
<td align="left">项目的入口<code>html</code>文件，采用<code>ejs</code>作为渲染引擎</td>
</tr>
<tr>
<td align="center"><code>index.tsx</code></td>
<td align="left">项目的入口<code>js</code>文件，后缀使用<code>tsx</code>，原因有二：<br/>1. 我们会使用<code>ts</code>进行<code>React</code>程序的开发 <br/>2. <code>.tsx</code>文件在vs code上的<code>icon</code>比较好看 :p</td>
</tr>
<tr>
<td align="center"><code>tsconfig.json</code></td>
<td align="left">是用于<code>tsc</code>编译执行的一些配置文件</td>
</tr>
<tr>
<td align="center"><code>components</code></td>
<td align="left">组件存放的目录</td>
</tr>
<tr>
<td align="center"><code>config</code></td>
<td align="left">各种配置项存放的位置，类似请求接口的<code>host</code>或者各种状态的<code>map</code>映射之类的（可以理解为枚举对象们都在这里）</td>
</tr>
<tr>
<td align="center"><code>utils</code></td>
<td align="left">一些公共函数存放的位置，各种可复用的代码都应该放在这里</td>
</tr>
<tr>
<td align="center"><code>dist</code></td>
<td align="left">各种静态资源的存放位置，图片之类文件</td>
</tr>
<tr>
<td align="center"><code>webpack</code></td>
<td align="left">里边存放了各种环境的<code>webpack</code>脚本命令以及<code>dll</code>的生成</td>
</tr>
</tbody></table>
<h2 id="前后端复用代码的一个尝试"><a href="#前后端复用代码的一个尝试" class="headerlink" title="前后端复用代码的一个尝试"></a>前后端复用代码的一个尝试</h2><p>实际上边还漏掉了一个新增的文件夹，我们在<code>src</code>目录下新增了一个<code>common</code>目录，这个目录是存放一些公共的函数和公共的<code>config</code>，不同于<code>utils</code>或者<code>config</code>的是，这里的代码是前后端共享的，所以这里边的函数一定要是完全的不包含任何环境依赖，不包含任何业务逻辑的。  </p>
<p>类似的数字千分位，日期格式化，抑或是服务监听的端口号，这些不包含任何逻辑，也对环境没有强依赖的代码，我们都可以放在这里。<br>这也是没有做前后分离带来的一个小甜头吧，前后可以共享一部分代码。  </p>
<p>要实现这样的配置，基于上述项目需要修改如下几处：</p>
<ol>
<li><code>src</code>下的<code>utils</code>和<code>config</code>部分代码迁移到<code>common</code>文件夹下，主要是用于区分是否可前后通用</li>
<li>为了将对之前<code>node</code>结构方面的影响降至最低，我们需要在<code>common</code>文件夹下新增一个<code>index.ts</code>索引文件，并在<code>utils/index.ts</code>下引用它，这样对于<code>node</code>方面使用来讲，并不需要关心这个文件是来自<code>utils</code>还是<code>common</code></li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/common/utils/comma.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="title function_">default</span> (<span class="attr">num</span>: number): <span class="function"><span class="params">string</span> =&gt;</span> <span class="title class_">String</span>(num).<span class="title function_">replace</span>(<span class="regexp">/\B(?=(\d&#123;3&#125;)+$)/g</span>, <span class="string">&#x27;,&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// src/common/utils/index.ts</span></span><br><span class="line"><span class="keyword">export</span> &#123; <span class="keyword">default</span> <span class="keyword">as</span> comma &#125; <span class="keyword">from</span> <span class="string">&#x27;./comma&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// src/utils.index.ts</span></span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&#x27;../common/utils&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// src/app.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; comma &#125; <span class="keyword">from</span> <span class="string">&#x27;./utils&#x27;</span> <span class="comment">// 并不需要关心是来自common还是来自utils</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">comma</span>(<span class="number">1234567</span>)) <span class="comment">// 1,234,567</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>然后是配置<code>webpack</code>的<code>alias</code>属性，用于<code>webpack</code>能够正确的找到其路径</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// client-src/webpack/base.js</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">resolve</span>: &#123;</span><br><span class="line">    <span class="attr">alias</span>: &#123;</span><br><span class="line">       <span class="string">&#x27;@Common&#x27;</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;../../src/common&#x27;</span>),</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>同时我们还需要配置<code>tsconfig.json</code>用于<code>vs code</code>可以找到对应的目录，不然会在编辑器中提示<code>can&#39;t find module XXX</code></li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// client-src/tsconfig.json</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;compilerOptions&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;paths&quot;</span>: &#123;</span><br><span class="line">      <span class="comment">// 用于引入某个`module`</span></span><br><span class="line">      <span class="string">&quot;@Common/*&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;../src/common/*&quot;</span></span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>最后在<code>client-src/utils/index.ts</code>写上类似<code>server</code>端的处理就可以了</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// client-src/utils/index.ts</span></span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&#x27;@Common/utils&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// client-src/index.tsx</span></span><br><span class="line"><span class="keyword">import</span> &#123; comma &#125; <span class="keyword">from</span> <span class="string">&#x27;./utils&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">comma</span>(<span class="number">1234567</span>)) <span class="comment">// 1,234,567</span></span><br></pre></td></tr></table></figure>

<h2 id="环境的搭建"><a href="#环境的搭建" class="headerlink" title="环境的搭建"></a>环境的搭建</h2><p><em>如果使用<code>vs code</code>进行开发，而且使用了<code>ESLint</code>的话，需要修改<code>TS</code>语法支持的后缀，添加<code>typescriptreact</code>的一些处理，这样才会自动修复一些<code>ESLint</code>的规则：</em>  </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;eslint.validate&quot;</span>: [</span><br><span class="line">  <span class="string">&quot;javascript&quot;</span>,</span><br><span class="line">  <span class="string">&quot;javascriptreact&quot;</span>,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">&quot;language&quot;</span>: <span class="string">&quot;typescript&quot;</span>,</span><br><span class="line">    <span class="string">&quot;autoFix&quot;</span>: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">&quot;language&quot;</span>: <span class="string">&quot;typescriptreact&quot;</span>,</span><br><span class="line">    <span class="string">&quot;autoFix&quot;</span>: <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h3 id="webpack的配置"><a href="#webpack的配置" class="headerlink" title="webpack的配置"></a>webpack的配置</h3><p>因为在前端使用了<code>React</code>，按照目前的主流，<code>webpack</code>肯定是必不可少的。<br>并没有选择成熟的<code>cra</code>(<a href="https://www.npmjs.com/package/create-react-app">create-react-app</a>)来进行环境搭建，原因有下：  </p>
<ol>
<li><code>webpack</code>更新到4以后并没有尝试过，想自己耍一耍</li>
<li>结合着<code>TS</code>以及公司内部的东西，会有一些自定义配置情况的出现，担心二次开发太繁琐</li>
</ol>
<p>但是其实也没有太多的配置，本次重构选用的UI框架为Google Material的实现：<a href="https://material-ui.com/">material-ui</a><br>而他们采用的是<a href="http://cssinjs.org/">jss</a> 来进行样式的编写，所以也不会涉及到之前惯用的<code>scss</code>的那一套<code>loader</code>了。  </p>
<p><code>webpack</code>分了大概如下几个文件：</p>
<table>
<thead>
<tr>
<th align="center">file</th>
<th align="left">desc</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><code>common.js</code></td>
<td align="left">公共的<code>webpack</code>配置，类似<code>env</code>之类的选项</td>
</tr>
<tr>
<td align="center"><code>dll.js</code></td>
<td align="left">用于将一些不会修改的第三方库进行提前打包，加快开发时编译效率</td>
</tr>
<tr>
<td align="center"><code>base.js</code></td>
<td align="left">可以理解为是<code>webpack</code>的基础配置文件，通用的<code>loader</code>以及<code>plugins</code>在这里</td>
</tr>
<tr>
<td align="center"><code>pro.js</code></td>
<td align="left">生产环境的特殊配置（代码压缩、资源上传）</td>
</tr>
<tr>
<td align="center"><code>dev.js</code></td>
<td align="left">开发环境的特殊配置（<code>source-map</code>）</td>
</tr>
</tbody></table>
<p><code>dll</code>是一个很早之前的套路了，大概需要修改这么几处：</p>
<ol>
<li>创建一个单独的<code>webpack</code>文件，用于生成<code>dll</code>文件</li>
<li>在普通的<code>webpack</code>文件中进行引用生成的<code>dll</code>文件</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// dll.js</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">entry</span>: &#123;</span><br><span class="line">    <span class="comment">// 需要提前打包的库</span></span><br><span class="line">    <span class="attr">vendors</span>: [</span><br><span class="line">      <span class="string">&#x27;react&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;react-dom&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;react-router-dom&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;babel-polyfill&#x27;</span>,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&#x27;vendors.dll.js&#x27;</span>,</span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;../../client-dist&#x27;</span>),</span><br><span class="line">    <span class="comment">// 输出时不要少了这个option</span></span><br><span class="line">    <span class="attr">library</span>: <span class="string">&#x27;vendors_lib&#x27;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> webpack.<span class="title class_">DllPlugin</span>(&#123;</span><br><span class="line">      <span class="attr">context</span>: __dirname,</span><br><span class="line">      <span class="comment">// 向外抛出的`vendors.dll.js`代码的具体映射，引用`dll`文件的时候通过它来做映射关系的</span></span><br><span class="line">      <span class="attr">path</span>: path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;../dist/vendors-manifest.json&#x27;</span>),</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;vendors_lib&#x27;</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// base.js</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> webpack.<span class="title class_">DllReferencePlugin</span>(&#123;</span><br><span class="line">      <span class="attr">context</span>: __dirname,</span><br><span class="line">      <span class="attr">manifest</span>: <span class="built_in">require</span>(<span class="string">&#x27;../dist/vendors-manifest.json&#x27;</span>),</span><br><span class="line">    &#125;),</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样在<code>watch</code>文件时，打包就会跳过<code>verdors</code>中存在的那些包了。<br><strong>有一点要注意的，如果最终需要上传这些静态资源，记得连带着<code>verdors.dll.js</code>一并上传</strong>  </p>
<p>在本地开发时，<code>vendors</code>文件并不会自动注入到<code>html</code>模版中去，所以我们有用到了另一个插件，<a href="https://www.npmjs.com/package/add-asset-html-webpack-plugin">add-asset-html-webpack-plugin</a>。<br>同时在使用中可能还会遇到<code>webpack</code>无限次数的重新打包，这个需要配置<code>ignore</code>来解决-.-：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// dev.js</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">HtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;html-webpack-plugin&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">AddAssetHtmlPlugin</span> = <span class="title function_">require</span>(<span class="params"><span class="string">&#x27;add-asset-html-webpack-plugin&#x27;</span></span>)</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="comment">// 将`ejs`模版文件放到目标文件夹，并注入入口`js`文件</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="attr">template</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;../index.ejs&#x27;</span>),</span><br><span class="line">      <span class="attr">filename</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;../../views/index.ejs&#x27;</span>),</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="comment">// 将`vendors`文件注入到`ejs`模版中</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">AddAssetHtmlPlugin</span>(&#123;</span><br><span class="line">      <span class="attr">filepath</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;../../client-dist/vendors.dll.js&#x27;</span>),</span><br><span class="line">      <span class="attr">includeSourcemap</span>: <span class="literal">false</span>,</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="comment">// 忽略`ejs`和`js`的文件变化，避免`webpack`无限重新打包的问题</span></span><br><span class="line">    <span class="keyword">new</span> webpack.<span class="title class_">WatchIgnorePlugin</span>([</span><br><span class="line">      <span class="regexp">/\.ejs$/</span>,</span><br><span class="line">      <span class="regexp">/\.js$/</span>,</span><br><span class="line">    ]),</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="TypeScript相关的配置"><a href="#TypeScript相关的配置" class="headerlink" title="TypeScript相关的配置"></a>TypeScript相关的配置</h3><p><code>TS</code>的配置分了两块，一个是<code>webpack</code>的配置，另一个是<code>tsconfig</code>的配置。  </p>
<p>首先是<code>webpack</code>，针对<code>ts</code>、<code>tsx</code>文件我们使用了两个<code>loader</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">rules</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">test</span>: <span class="regexp">/\.tsx?$/</span>,</span><br><span class="line">      <span class="attr">use</span>: [<span class="string">&#x27;babel-loader&#x27;</span>, <span class="string">&#x27;ts-loader&#x27;</span>],</span><br><span class="line">      <span class="attr">exclude</span>: <span class="regexp">/node_modules/</span>,</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">resolve</span>: &#123;</span><br><span class="line">    <span class="comment">// 一定不要忘记配置ts tsx后缀</span></span><br><span class="line">    <span class="attr">extensions</span>: [<span class="string">&#x27;.tsx&#x27;</span>, <span class="string">&#x27;.ts&#x27;</span>, <span class="string">&#x27;.js&#x27;</span>],</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>ts-loader</code>用于将<code>TS</code>的一些特性转换为<code>JS</code>兼容的语法，然后执行<code>babel</code>进行处理<code>react/jsx</code>相关的代码，最终生成可执行的<code>JS</code>代码。  </p>
<p>然后是<code>tsconfig</code>的配置，<code>ts-loader</code>的执行是依托于这里的配置的，大致的配置如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;compilerOptions&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;module&quot;</span>: <span class="string">&quot;esnext&quot;</span>,</span><br><span class="line">    <span class="string">&quot;target&quot;</span>: <span class="string">&quot;es6&quot;</span>,</span><br><span class="line">    <span class="string">&quot;allowSyntheticDefaultImports&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="comment">// import的相对起始路径</span></span><br><span class="line">    <span class="string">&quot;baseUrl&quot;</span>: <span class="string">&quot;.&quot;</span>,</span><br><span class="line">    <span class="string">&quot;sourceMap&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="comment">// 构建输出目录，但因为使用了`webpack`，所以这个配置并没有什么卵用</span></span><br><span class="line">    <span class="string">&quot;outDir&quot;</span>: <span class="string">&quot;../client-dist&quot;</span>,</span><br><span class="line">    <span class="comment">// 开启`JSX`模式, </span></span><br><span class="line">    <span class="comment">// `preserve`的配置让`tsc`不会去处理它，而是使用后续的`babel-loader`进行处理</span></span><br><span class="line">    <span class="string">&quot;jsx&quot;</span>: <span class="string">&quot;preserve&quot;</span>, </span><br><span class="line">    <span class="string">&quot;strict&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;moduleResolution&quot;</span>: <span class="string">&quot;node&quot;</span>,</span><br><span class="line">    <span class="comment">// 开启装饰器的使用</span></span><br><span class="line">    <span class="string">&quot;experimentalDecorators&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;emitDecoratorMetadata&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="comment">// `vs code`所需要的，在开发时找到对应的路径，真实的引用是在`webpack`中配置的`alias`</span></span><br><span class="line">    <span class="string">&quot;paths&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;@Common&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;../src/common&quot;</span></span><br><span class="line">      ],</span><br><span class="line">      <span class="string">&quot;@Common/*&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;../src/common/*&quot;</span></span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;exclude&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;node_modules&quot;</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ESLint的配置"><a href="#ESLint的配置" class="headerlink" title="ESLint的配置"></a>ESLint的配置</h3><p>最近这段时间，我们团队基于<code>airbnb</code>的<code>ESLint</code>规则进行了一些自定义，创建了自家的<a href="https://www.npmjs.com/package/eslint-config-blued">eslint-config-blued</a><br>同时还存在了<a href="https://www.npmjs.com/package/eslint-config-blued-react">react</a>和<a href="https://www.npmjs.com/package/eslint-config-blued-typescript">typescript</a>的两个衍生版本。  </p>
<p>关于<code>ESLint</code>的配置文件<code>.eslintrc</code>，在本项目中存在两份。一个是根目录的<code>blued-typescript</code>，另一个是<code>client-src</code>下的<code>blued-react</code> + <code>blued-typescript</code>。<br>因为根目录的更多用于<code>node</code>项目，所以没必要把<code>react</code>什么的依赖也装进来。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># .eslintrc</span></span><br><span class="line"><span class="attr">extends:</span> <span class="string">blued-typescript</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># client-src/.eslintrc</span></span><br><span class="line"><span class="attr">extends:</span> </span><br><span class="line">  <span class="bullet">-</span> <span class="string">blued-react</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">blued-typescript</span></span><br></pre></td></tr></table></figure>

<p><strong>一个需要注意的小细节</strong><br>因为我们的<code>react</code>与<code>typescript</code>实现版本中都用到了<code>parser</code>。<br><code>react</code>使用的是<a href="https://www.npmjs.com/package/babel-eslint">babel-eslint</a>，<code>typescript</code>使用的是<a href="https://www.npmjs.com/package/typescript-eslint-parser">typescript-eslint-parser</a>。<br>但是<code>parser</code>只能有一个，从<code>option</code>的命名中就可以看出<code>extends</code>、<code>plugins</code>、<code>rules</code>，到了<code>parser</code>就没有复数了。<br>所以这两个插件在<code>extends</code>中的顺序就变得很关键，<code>babel</code>现在并不能理解<code>TS</code>的语法，但好像<code>babel</code>开发者有支持<code>TS</code>的<a href="https://github.com/babel/babel-eslint/issues/505">意愿</a>。<br>但就目前来说，一定要保证<code>react</code>在前，<code>typescript</code>在后，这样<code>parser</code>才会使用<code>typescript-eslint-parser</code>来进行覆盖。  </p>
<h3 id="node层的修改"><a href="#node层的修改" class="headerlink" title="node层的修改"></a>node层的修改</h3><p>除了上边提到的两端公用代码以外，还需要添加一个<code>controller</code>用于吐页面，因为使用的是<code>routing-controllers</code>这个库，渲染一个静态页面被封装的非常棒，仅仅需要修改两个页面，一个用于设置<code>render</code>模版的根目录，另一个用来设置要吐出来的模版名称：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// controller/index.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  <span class="title class_">Get</span>,</span><br><span class="line">  <span class="title class_">Controller</span>,</span><br><span class="line">  <span class="title class_">Render</span>,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;routing-controllers&#x27;</span></span><br><span class="line"></span><br><span class="line">@<span class="title class_">Controller</span>(<span class="string">&#x27;/&#x27;</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> &#123;</span><br><span class="line">  @<span class="title class_">Get</span>(<span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">  @<span class="title class_">Render</span>(<span class="string">&#x27;index&#x27;</span>) <span class="comment">// 指定一个模版的名字</span></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">router</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 渲染页面时的一些变量</span></span><br><span class="line">    <span class="comment">// 类似之前的 ctx.state = XXX</span></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&#x27;First TypeScript React App&#x27;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// app.ts</span></span><br><span class="line"><span class="keyword">import</span> koaViews <span class="keyword">from</span> <span class="string">&#x27;koa-views&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加模版所在的目录</span></span><br><span class="line"><span class="comment">// 以及使用的渲染引擎、文件后缀</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">koaViews</span>(path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;../views&#x27;</span>), &#123;</span><br><span class="line">  <span class="attr">options</span>: &#123;</span><br><span class="line">    <span class="attr">ext</span>: <span class="string">&#x27;ejs&#x27;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">extension</span>: <span class="string">&#x27;ejs&#x27;</span>,</span><br><span class="line">&#125;))</span><br></pre></td></tr></table></figure>

<p><em>如果是多个页面，那就创建多个用来<code>Render</code>的<code>ts</code>文件就好了</em>  </p>
<h4 id="深坑，注意"><a href="#深坑，注意" class="headerlink" title="深坑，注意"></a>深坑，注意</h4><p>目前的<code>routing-controller</code>对于<code>Koa</code>的支持还不是很好，（原作者对<code>Koa</code>并不是很了解，导致<code>Render</code>对应的接口被请求一次以后，后续所有的其他的接口都会直接返回该模版文件，原因是在负责模版渲染的<code>URL</code>触发时，本应返回数据，但是目前的处理却是添加了一个中间件到<code>Koa</code>中，所以任何请求都会将该模版文件作为数据来返回）所以<code>@Render</code>并不能适用于<code>Koa</code>驱动。<br>不过我已经提交了<a href="https://github.com/typestack/routing-controllers/pull/434">PR</a>了，跑通了测试用例，坐等被合并代码，但是这是一个临时的修改方案，涉及到这个库针对外部中间件注册的顺序问题，所以对于<code>app.ts</code>还要有额外的修改才能够实现。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app.ts 的修改</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;reflect-metadata&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Koa</span> <span class="keyword">from</span> <span class="string">&#x27;koa&#x27;</span></span><br><span class="line"><span class="keyword">import</span> koaViews <span class="keyword">from</span> <span class="string">&#x27;koa-views&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useKoaServer &#125; <span class="keyword">from</span> <span class="string">&#x27;routing-controllers&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; distPath &#125; <span class="keyword">from</span> <span class="string">&#x27;./config&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 手动创建koa实例，然后添加`render`的中间件，确保`ctx.render`方法会在请求的头部就被添加进去</span></span><br><span class="line"><span class="keyword">const</span> koa = <span class="keyword">new</span> <span class="title class_">Koa</span>()</span><br><span class="line"></span><br><span class="line">koa.<span class="title function_">use</span>(<span class="title function_">koaViews</span>(path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;../views&#x27;</span>), &#123;</span><br><span class="line">  <span class="attr">options</span>: &#123;</span><br><span class="line">    <span class="attr">ext</span>: <span class="string">&#x27;ejs&#x27;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">extension</span>: <span class="string">&#x27;ejs&#x27;</span>,</span><br><span class="line">&#125;))</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用`useKoaServer`而不是`createKoaServer`</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">useKoaServer</span>(koa, &#123;</span><br><span class="line">  <span class="attr">controllers</span>: [<span class="string">`<span class="subst">$&#123;__dirname&#125;</span>/controllers/**/*&#123;.js,.ts&#125;`</span>],</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 后续的逻辑就都一样了</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> app</span><br></pre></td></tr></table></figure>

<p>当然，这个是新版发出以后的逻辑了，基于现有的结构也可以绕过去，但是就不能使用<code>@Render</code>装饰器了，抛开<code>koa-views</code>直接使用内部的<a href="https://github.com/tj/consolidate.js">consolidate</a>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// controller/index.ts</span></span><br><span class="line"><span class="comment">// 这个修改不需要改动`app.ts`，可以直接使用`createKoaServer`</span></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  <span class="title class_">Get</span>,</span><br><span class="line">  <span class="title class_">Controller</span>,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;routing-controllers&#x27;</span></span><br><span class="line"><span class="keyword">import</span> cons <span class="keyword">from</span> <span class="string">&#x27;consolidate&#x27;</span></span><br><span class="line"><span class="keyword">import</span> path <span class="keyword">from</span> <span class="string">&#x27;path&#x27;</span></span><br><span class="line"></span><br><span class="line">@<span class="title class_">Controller</span>()</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> &#123;</span><br><span class="line">  @<span class="title class_">Get</span>(<span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">router</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 直接在接口返回时获取模版渲染后的数据</span></span><br><span class="line">    <span class="keyword">return</span> cons.<span class="title function_">ejs</span>(path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;../../views/index.ejs&#x27;</span>), &#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&#x27;Example For TypeScript React App&#x27;</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><em>目前的示例代码采用的上边的方案</em></p>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>至此，一个完整的TS前后端项目架构就已经搭建完成了（剩下的任务就是往骨架里边填代码了）。<br>我已经更新了之前的<a href="https://github.com/Jiasm/typescript-example">typescript-exmaple</a>  在里边添加了本次重构所使用的一些前端<code>TS</code>+<code>React</code>的示例，还包括针对<code>@Render</code>的一些兼容。  </p>
<p><code>TypeScript</code>是一个很棒的想法，解决了N多<code>javaScript</code>种令人诟病的问题。<br>使用静态语言来进行开发不仅能够提高开发的效率，同时还能降低错误出现的几率。<br>结合着强大的<code>vs code</code>，Enjoy it.  </p>
<p>如果在使用<code>TS</code>的过程中有什么问题、或者有什么更好的想法，欢迎来沟通讨论。  </p>

</div>

<section class="comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>
<script>
  var disqus_shortname = 'jiashunming';
  
  var disqus_url = 'http://jiasm.github.io/2018/08/26/TypeScript%E5%9C%A8react%E9%A1%B9%E7%9B%AE%E4%B8%AD%E7%9A%84%E5%AE%9E%E8%B7%B5/';
  
  var disqus_config = function () {
    this.page.url = location.href
    this.page.identifier = '045e3c30-a907-11e8-b31a-b7afa1b30f1e'
    this.page.title = document.querySelector('h1').innerText
  };
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.setAttribute('data-timestamp', +new Date());
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>

<script>
  // I'm not sure your browser supports `es6`
  window.addEventListener('load', function () {
    [].concat(Array.from(document.querySelectorAll('code')), Array.from(document.querySelectorAll('pre'))).filter(function (item) {return item.className.indexOf('language') >= 0}).forEach(function (tag) { tag.classList.add('line-numbers') })
    Prism.highlightAll()

    let scrollY = window.scrollY
    let headersList = Array.from(document.querySelector('#post-content').querySelectorAll('h1,h2,h3,h4,h5,h6')).map(function (item) {
      let rect = item.getBoundingClientRect()
      let anchorTag = document.querySelector(`a.toc-link[href="#${item.id}"]`)

      if (!anchorTag) return
      return {
        top: scrollY + rect.top - rect.height,
        tag: item,
        anchorTag: anchorTag
      }
    }).filter(function (item) { return item })

    window.addEventListener('scroll', debounce(scrollHandler, 200))
    scrollHandler()

    function scrollHandler () {
      let scrollY = window.scrollY
      let minInfo = null

      for (let item of headersList) {
        if (!minInfo) {
          minInfo = item
          continue
        }

        if ((scrollY - item.top) >= 0 && (scrollY - minInfo.top) > (scrollY - item.top)) {
          minInfo = item
        }
      }

      if (minInfo) {
        headersList.forEach(function (item) {
          item.anchorTag && item.anchorTag.classList.remove('selected')
        })
        minInfo.anchorTag.classList.add('selected')
      }
    }

    function debounce (func, delay) {
      let debounceIdentify = 0
      return function () {
        debounceIdentify && clearTimeout(debounceIdentify)
        debounceIdentify = setTimeout(function () {
          debounceIdentify = 0
          func.apply(this, arguments)
        }, delay)
      }
    }
  })
</script>

        </main>
        <a href="#" class="goto-top">
          <i class="fa fa-chevron-up"></i>
        </a>
    </div>
    <footer class="footer">
  <div class="footer-content">
    <div class="footer-info" class="inner">
      <p class="copyright">&copy; 2025 ShunMing Jia<br></p>
      powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
      theme by <a href="https://github.com/Jiasm/hexo-theme-sheet" target="_blank">Sheet</a>
    </div>
    <ul class="contact-info">
      
        <a class="contact-link" href="https://github.com/jiasm" target="_blank"><i class="fa fa-github"></i></a>
      
      
        <a class="contact-link" href="https://weibo.com/jarvis1996" target="_blank"><i class="fa fa-weibo"></i></a>
      
      
        <a class="contact-link" href="https://twitter.com/jiashm" target="_blank"><i class="fa fa-twitter"></i></a>
      
      
        <a class="contact-link" href="https://www.facebook.com/jiashunming" target="_blank"><i class="fa fa-facebook"></i></a>
      
      
        <a class="contact-link" href="mailto:jiashunming@outlook.com" target="_blank"><i class="fa fa-envelope"></i></a>
      
    </ul>
  </div>
</footer>

  <!-- 使用 DISQUS js 代码 -->
  <script id="dsq-count-scr" src="//jiashunming.disqus.com/count.js" async="async"></script>



      <script>
      function footerHandler () {
        if (!window.screen || !document.body) return
        var hasComments = document.querySelector('.comments')
        if ((window.screen.availHeight - (hasComments ? 350 : 0)) > document.body.clientHeight) {
          document.body.classList.add('fixed')
        } else {
          document.body.classList.remove('fixed')
        }
      }
      footerHandler()
      window.addEventListener('resize', footerHandler)
    </script>
  </body>
  <script>
    var pathname = new URL(location.href).pathname.replace(/\/$/, '')

    switch (pathname) {
      case '/about':
        document.querySelector('.menu-item-about').classList.add('active')
        break
      case '/contact':
        document.querySelector('.menu-item-contact').classList.add('active')
        break
      case '/links':
        document.querySelector('.menu-item-friends').classList.add('active')
        break
      default:
        document.querySelector('.menu-item-home').classList.add('active')
    }
  </script>
  
    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?f1f7cb8bfb6de7f6a6277fee35703d98";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
    </script>
    

</html>