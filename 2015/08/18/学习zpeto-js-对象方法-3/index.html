<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  
  
  
  
  <title>学习zpeto.js(对象方法)[3] - Jarvis&#39;s Blog</title>
  <link rel="stylesheet" href="/css/style.css">
<link rel="stylesheet" href="/css/prism-coy.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"><script src="/js/prism.js"></script>
<script src="/js/prism-line-numbers.min.js"></script></head>


  <body class="fixed">
    <div class="container">
      <header class="header">
  <div class="blog-title">
    <a href="/" class="logo">Jarvis&#39;s Blog</a>
  </div>
  <nav class="navbar">
    <ul class="menu">
      
        <li class="menu-item">
          <a href="/" class="menu-item-link menu-item-home">Home</a>
        </li>
      
        <li class="menu-item">
          <a href="/about" class="menu-item-link menu-item-about">About</a>
        </li>
      
        <li class="menu-item">
          <a href="/contact" class="menu-item-link menu-item-contact">Contact</a>
        </li>
      
        <li class="menu-item">
          <a href="/links" class="menu-item-link menu-item-friends">Friends</a>
        </li>
      
        <li class="menu-item">
          <a href="https://github.com/jiasm" class="menu-item-link menu-item-github">Github</a>
        </li>
      
    </ul>
  </nav>
</header>

        <main class="main">
          
  <input type="checkbox" id="toggle-toc" class="toggle-toc-right" />
  <div class="toc-toggle toc-toggle-right">
    <label for="toggle-toc">
      <i class="fa fa-list-ol"></i>
    </label>
    <div class="toc-wrap toc-wrap-right">
      <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#attr"><span class="toc-number">1.</span> <span class="toc-text">attr():</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#get"><span class="toc-number">1.1.</span> <span class="toc-text">get:</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#set"><span class="toc-number">1.2.</span> <span class="toc-text">set:</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#remove"><span class="toc-number">1.3.</span> <span class="toc-text">remove:</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#removeAttr"><span class="toc-number">2.</span> <span class="toc-text">removeAttr:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#prop"><span class="toc-number">3.</span> <span class="toc-text">prop:</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#attr-1"><span class="toc-number">3.1.</span> <span class="toc-text">attr</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#removeAttr-1"><span class="toc-number">3.2.</span> <span class="toc-text">removeAttr</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#prop-1"><span class="toc-number">3.3.</span> <span class="toc-text">prop</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#data"><span class="toc-number">4.</span> <span class="toc-text">data:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#val"><span class="toc-number">5.</span> <span class="toc-text">val:</span></a></li></ol>
    </div>
  </div>
  <label class="mask" for="toggle-toc"></label>

<div id="post-content">
  <h1>学习zpeto.js(对象方法)[3]</h1>
  <p>继续说zepto里attributes的相关操作.</p>
<p>attr,removeAttr,prop这三个方法.<br><a id="more"></a></p>
<h3 id="attr"><a href="#attr" class="headerlink" title="attr():"></a>attr():</h3><p>三种用途</p>
<h4 id="get"><a href="#get" class="headerlink" title="get:"></a>get:</h4><p>返回值为一个string字符串</p>
<pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"&lt;span id="</span>special<span class="token string">">&lt;/span>"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//--> "special"</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>注意:只能返回对象中第一个节点的属性值</p>
<h4 id="set"><a href="#set" class="headerlink" title="set:"></a>set:</h4><p>返回值为一个zepto对象</p>
<pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"&lt;span>"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">,</span><span class="token string">"special"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//--> [&lt;span id="special">&lt;/span>]</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>第二个参数也可以传入一个function,有两个参数可以使用</p>
<p>1:index,zepto对象dom元素数组的下标</p>
<p>2:value,该对象对应属性的值</p>
<pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"&lt;div id='demo1'>&lt;/div>"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// --> 0 demo1</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>上边那段代码如果执行了.那么该zepto对象的id属性值就会被清除,因为该函数没有返回字符串用来设置值.</p>
<p>或者也可以直接传入一个json串来修改多个属性.</p>
<pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"&lt;span>"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    
  id<span class="token punctuation">:</span><span class="token string">'special'</span><span class="token punctuation">,</span>    
  name<span class="token punctuation">:</span><span class="token string">'special'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="remove"><a href="#remove" class="headerlink" title="remove:"></a>remove:</h4><p>返回值也是一个zepto对象,作用相当于调用removeAttr()</p>
<p>$(“<span id="special"></span>“).attr(“id”,null);//–&gt; [<span></span>]</p>
<p>需注意的只能传入null才能触发remove效果.</p>
<p>传入function与json都可以,只要是返回值或者值为null,都会触发remove;</p>
<h3 id="removeAttr"><a href="#removeAttr" class="headerlink" title="removeAttr:"></a>removeAttr:</h3><p>removeAttr相当于(功能)是attr的一部分.但是代码实现是分开的.这个函数应用场景比较单一,所以省去了很多判断.但最终都是调用的function getAttribute(){};</p>
<p>只接收一个参数,就是name</p>
<p>返回值是一个zepto对象.</p>
<pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"&lt;span id="</span>special<span class="token string">">&lt;/span>"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">removeAttr</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//--> [&lt;span>&lt;/span>]</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>移除多个属性请用空格分开</p>
<h3 id="prop"><a href="#prop" class="headerlink" title="prop:"></a>prop:</h3><p>prop用来设置或取出dom元素的属性值.功能相当于 (prop = attr - removeAttr);</p>
<p>prop用法与attr相同.只不过没有remove功能.两者的区别在这里</p>
<p>读取或设置dom元素的属性值。它在读取属性值的情况下优先于 <a href="http://www.css88.com/doc/zeptojs/#attr" target="_blank" rel="noopener">attr</a>，因为这些属性值会因为用户的交互发生改变，如checked 和 selected。</p>
<p>那是zepto.js中文api中所说的.本人认为,在判断有关交互的属性时,应优先使用prop,比如checked和selected;<br><img src="/images/learning-zepto-js-object-third/screen-shot-1.png" alt=""><br><img src="/images/learning-zepto-js-object-third/screen-shot-2.png" alt=""></p>
<p>之所以为出现差异,是因为两者底层实现的区别.<br><img src="/images/learning-zepto-js-object-third/screen-shot-3.png" alt=""></p>
<p>prop采用的是上边那种,而attr是两种都用到了;</p>
<p>getAttribute()方法只能取出存在于标签中的属性”<div id="" name=""></div>“ // 只能取出id与name.隐式的属性是取不出来的,比如style<br><img src="/images/learning-zepto-js-object-third/screen-shot-4.png" alt=""><br><img src="/images/learning-zepto-js-object-third/screen-shot-5.png" alt=""></p>
<p>来说说实现吧.</p>
<h4 id="attr-1"><a href="#attr-1" class="headerlink" title="attr"></a>attr</h4><p>attr返回的那个三元运算符嵌套写的有点虎…待我细细说来;</p>
<p>–首先判断name参数是否为字符串,并且只有一个实参.这样来讲就是get功能.</p>
<p>—-如果this.length不存在.则说明不是一个zepto对象(理论上),如果数组中第一个对象的nodeType值不为1,则说明不是节点对象.直接返回undefined</p>
<p>—-否则就从调用该节点的getAttribute方法,并赋值给result变量. name in this[0] 这个表达式返回一个bool值.同时将result使用!来转换为bool值.如果没有通过getAttribute方法取出来值,并且该属性存在于节点,</p>
<p>——通过节点直接取值.</p>
<p>——否则直接返回getAttribute的返回值.</p>
<p>–剩下来的就是set与remove功能的实现,这两个是支持多对象的操作.返回值均为调用者本身(调用者调用了each循环,循环所有节点对象).</p>
<p>—-如果对象不是一个节点对象,则直接跳过本次循环;</p>
<p>—-如果name为一个object,就是说我们一次性更改多个属性值.这时就循环object对象,来调用setAttribute方法</p>
<p>—-剩下的条件就是给单个属性赋值,之前说过那个funcArg方法,判断第二个参数是否为function类型,如果是则通过当前节点为作用域执行方法,否则直接返回第二个参数.</p>
<p>关于是否进行set还是remove,这些是在setAttribute方法中做的处理.一个简单的三元运算符;</p>
<h4 id="removeAttr-1"><a href="#removeAttr-1" class="headerlink" title="removeAttr"></a>removeAttr</h4><p>参数只有一个,name,就是要移除的属性的名称,</p>
<p>大体执行过程为,循环调用方法的对象,并将传入的name按空格分割为数组并执行forEach循环,forEach循环传入第二个参数为循环内部this的指向.然后在内部调用setAttribute方法.只传入两个参数,则执行removeAttribute方法;</p>
<h4 id="prop-1"><a href="#prop-1" class="headerlink" title="prop"></a>prop</h4><p>参数为两个.第一个固定为属性的名称,第二个可以为一个function,一个字符串.同样,如果不传第二个参数则认为是get,否则是set.</p>
<p>执行过程与attr的类似,但是attr赋值是通过setAttribute()方法,取值是getAttribute()与对象属性取值的结合.而prop完全操作的是对象的属性;</p>
<p>再来点吧.说说data方法与val方法.都是操作dom属性的.一气儿说完它;</p>
<h3 id="data"><a href="#data" class="headerlink" title="data:"></a>data:</h3><p>方法接受两个参数,第一个是name,第二个为值,如果不填第二个则执行取值,否则为赋值</p>
<p>用法与attr类似,但是会将传入的name值加上”data-“的前缀,并且会将驼峰命名转换为全小写连字符的格式;</p>
<p>取值时也不需要加”data-“前缀.</p>
<p>就是说,</p>
<pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//取的是 data-id属性的值</span>
<span class="token function">$</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token string">"userName"</span><span class="token punctuation">,</span><span class="token string">"scott"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//给data-user-name属性赋值</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>第二个参数也可以是一个function;</p>
<p>actually,data方法内部调用的就是attr方法<br><img src="/images/learning-zepto-js-object-third/screen-shot-6.png" alt=""></p>
<p>deserializeValue是一个反序列化函数,如果有其他地方需要,不妨将该方法copy出去;</p>
<p><img src="/images/learning-zepto-js-object-third/screen-shot-7.png" alt=""></p>
<h3 id="val"><a href="#val" class="headerlink" title="val:"></a>val:</h3><p>方法接收一个参数,如果不填,则视为取value值,否则为设置value值.</p>
<pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// getter</span>
<span class="token function">$</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// setter</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>参数可以是一个字符串,function;function接收的参数为(index[对象的下标],value[对象之前的值]),function需返回一个字符串;</p>
<p><img src="/images/learning-zepto-js-object-third/screen-shot-8.png" alt=""></p>
<p>方法本身无亮点,但是返回值有三种;</p>
<p>一:</p>
<p>　　返回一个字符串,作为get值时返回;</p>
<p>二:</p>
<p>　　返回一个字符串数组,作为get值时返回;</p>
<p>三:</p>
<p>　　返回对象本身,作为set值时返回;</p>
<p>之所以会存在第二种情况,那是因为select(下拉选项)是可以多选的.而开启多选的属性开关名字叫multiple;</p>
<p>当下拉选项开启多选时,直接通过value属性只会取到第一个值,其余的取不到.所以在代码中就做了处理;</p>
<p>取出对象所有的option子节点.通过filter方法返回被选中的节点集合,并调用pluck方法</p>
<p><img src="/images/learning-zepto-js-object-third/screen-shot-9.png" alt="">一个来自prototype.js大表哥中的方法;</p>
<p>传入一个属性名,将调用者集合中所有的该属性的值作为一个数组返回;</p>
<p>其余的没什么了.</p>
<p>如果有什么疑惑的地方还请留言问我.大家共同学习;</p>
<p>或者<a href="tencent://QQInterLive/?Cmd=2&amp;Uin=812788037" target="_blank" rel="noopener">我的扣扣</a></p>

</div>

<section class="comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>
<script>
  var disqus_shortname = 'jiashunming';
  
  var disqus_url = 'http://jiasm.github.io/2015/08/18/学习zpeto-js-对象方法-3/';
  
  var disqus_config = function () {
    this.page.url = location.href
    this.page.identifier = '8dc93020-b97a-11e6-bc5c-43642a86b907'
    this.page.title = document.querySelector('h1').innerText
  };
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.setAttribute('data-timestamp', +new Date());
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>

<script>
  // I'm not sure your browser supports `es6`
  window.addEventListener('load', function () {
    [].concat(Array.from(document.querySelectorAll('code')), Array.from(document.querySelectorAll('pre'))).filter(function (item) {return item.className.indexOf('language') >= 0}).forEach(function (tag) { tag.classList.add('line-numbers') })
    Prism.highlightAll()

    let scrollY = window.scrollY
    let headersList = Array.from(document.querySelector('#post-content').querySelectorAll('h1,h2,h3,h4,h5,h6')).map(function (item) {
      let rect = item.getBoundingClientRect()
      let anchorTag = document.querySelector(`a.toc-link[href="#${item.id}"]`)

      if (!anchorTag) return
      return {
        top: scrollY + rect.top - rect.height,
        tag: item,
        anchorTag: anchorTag
      }
    }).filter(function (item) { return item })

    window.addEventListener('scroll', debounce(scrollHandler, 200))
    scrollHandler()

    function scrollHandler () {
      let scrollY = window.scrollY
      let minInfo = null

      for (let item of headersList) {
        if (!minInfo) {
          minInfo = item
          continue
        }

        if ((scrollY - item.top) >= 0 && (scrollY - minInfo.top) > (scrollY - item.top)) {
          minInfo = item
        }
      }

      if (minInfo) {
        headersList.forEach(function (item) {
          item.anchorTag && item.anchorTag.classList.remove('selected')
        })
        minInfo.anchorTag.classList.add('selected')
      }
    }

    function debounce (func, delay) {
      let debounceIdentify = 0
      return function () {
        debounceIdentify && clearTimeout(debounceIdentify)
        debounceIdentify = setTimeout(function () {
          debounceIdentify = 0
          func.apply(this, arguments)
        }, delay)
      }
    }
  })
</script>

        </main>
        <a href="#" class="goto-top">
          <i class="fa fa-chevron-up"></i>
        </a>
    </div>
    <footer class="footer">
  <div class="footer-content">
    <div class="footer-info" class="inner">
      <p class="copyright">&copy; 2023 ShunMing Jia<br></p>
      powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
      theme by <a href="https://github.com/Jiasm/hexo-theme-sheet" target="_blank">Sheet</a>
    </div>
    <ul class="contact-info">
      
        <a class="contact-link" href="https://github.com/jiasm" target="_blank"><i class="fa fa-github"></i></a>
      
      
        <a class="contact-link" href="https://weibo.com/jarvis1996" target="_blank"><i class="fa fa-weibo"></i></a>
      
      
        <a class="contact-link" href="https://twitter.com/jiashm" target="_blank"><i class="fa fa-twitter"></i></a>
      
      
        <a class="contact-link" href="https://www.facebook.com/jiashunming" target="_blank"><i class="fa fa-facebook"></i></a>
      
      
        <a class="contact-link" href="mailto:jiashunming@outlook.com" target="_blank"><i class="fa fa-envelope"></i></a>
      
    </ul>
  </div>
</footer>

  <!-- 使用 DISQUS js 代码 -->
  <script id="dsq-count-scr" src="//jiashunming.disqus.com/count.js" async="async"></script>



      <script>
      function footerHandler () {
        if (!window.screen || !document.body) return
        var hasComments = document.querySelector('.comments')
        if ((window.screen.availHeight - (hasComments ? 350 : 0)) > document.body.clientHeight) {
          document.body.classList.add('fixed')
        } else {
          document.body.classList.remove('fixed')
        }
      }
      footerHandler()
      window.addEventListener('resize', footerHandler)
    </script>
  </body>
  <script>
    var pathname = new URL(location.href).pathname.replace(/\/$/, '')

    switch (pathname) {
      case '/about':
        document.querySelector('.menu-item-about').classList.add('active')
        break
      case '/contact':
        document.querySelector('.menu-item-contact').classList.add('active')
        break
      case '/links':
        document.querySelector('.menu-item-friends').classList.add('active')
        break
      default:
        document.querySelector('.menu-item-home').classList.add('active')
    }
  </script>
  
    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?f1f7cb8bfb6de7f6a6277fee35703d98";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
    </script>
    

</html>