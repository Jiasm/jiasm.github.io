{
  "id": "36f116c0-aa64-11e6-a1ed-8fca2e8c7bc3",
  "title": "如何在小程序中请求本地接口",
  "postDate": "2016/11/14 20:16",
  "content": "<h2>背景：</h2>\r\n<p>随着微信小程序开始公测，我司也拿到了AppID，所以开始了微信小程序的趟坑之旅。</p>\r\n<p>由于现在网上已经有很多的《微信小程序从精通到入门》的教程了，所以就不再重复那些，只是讲一下，在开发的过程中，如何使用本地（开发环境）的接口。</p>\r\n<p>因为小程序的开发文档中写到了，<strong>wx.request</strong>中的URL只能是一个https请求，本地一般来讲是不会有https的-.-</p>\r\n<p>所以我们使用Charles代理来实现需求。</p>\r\n<p>&nbsp;</p>\r\n<h2>前提：</h2>\r\n<p>本人认为你现在已经具备以下几个条件：</p>\r\n<p>0. &nbsp;具有微信小程序开发的权限</p>\r\n<p>1. &nbsp;知道自家小程序后台配置的信任域名都是什么-.-</p>\r\n<p>2. &nbsp;有一台Mac（阿哈哈...无视...截图来自Mac...Windows党请多担待）</p>\r\n<p>&nbsp;</p>\r\n<h2>准备工作：</h2>\r\n<p>首先我们需要安装如下两个软件：</p>\r\n<p>0. &nbsp;安装<a href=\"https://www.baidu.com/s?wd=charles破解版\">Charles</a>，当然了，是个破解版的-.- 破解方法请自行百度，不赘述</p>\r\n<p>1. &nbsp;安装<a href=\"https://mp.weixin.qq.com/wiki/10/e5f772f4521da17fa0d7304f68b97d7e.html#.E4.B8.8B.E8.BD.BD.E5.9C.B0.E5.9D.80\">微信web开发者工具</a></p>\r\n<p>&nbsp;</p>\r\n<h2>操作步骤：</h2>\r\n<p>到这一步，本人认为你已经安装好了上边两个软件，并且可以正常运行咯。</p>\r\n<p>0. &nbsp; &nbsp;首先打开Charles，<strong>Help-&gt;SSL Proxying-&gt;Install Charles Root Certificate</strong> 安装证书到本地</p>\r\n<p><img src=\"https://dn-web-blued-cn.qbox.me/web/static/iliveorders/install-charles-1-07dd23d5.png\" alt=\"undefined line-numbers\" width=\"364\" height=\"268\" /><img src=\"https://dn-web-blued-cn.qbox.me/web/static/iliveorders/install-charles-2-923a8b02.png\" alt=\"undefined line-numbers\" width=\"501\" height=\"180\" /></p>\r\n<p>1. &nbsp; &nbsp;在钥匙串访问中搜索 Charles 关键字，找到那个证书，点开后将信任选为<strong>始终信任</strong></p>\r\n<p><strong><img src=\"https://dn-web-blued-cn.qbox.me/web/static/iliveorders/config-charles-1-8950b03a.png\" alt=\"undefined line-numbers\" width=\"560\" height=\"355\" /></strong></p>\r\n<p><strong><img src=\"https://dn-web-blued-cn.qbox.me/web/static/iliveorders/config-charles-2-fd0a6091.png\" alt=\"undefined line-numbers\" width=\"559\" height=\"474\" /></strong></p>\r\n<p>2. &nbsp; &nbsp;打开&nbsp;<strong>Tools-&gt;Map Remote</strong> 添加线上域名于本地（开发环境）服务的映射</p>\r\n<p><img src=\"https://dn-web-blued-cn.qbox.me/web/static/iliveorders/config-remote-1-46cc0931.png\" alt=\"undefined line-numbers\" width=\"213\" height=\"382\" /></p>\r\n<p><img src=\"https://dn-web-blued-cn.qbox.me/web/static/iliveorders/config-remote-2-6f466269.png\" alt=\"undefined line-numbers\" width=\"600\" height=\"375\" /></p>\r\n<p><img src=\"https://dn-web-blued-cn.qbox.me/web/static/iliveorders/config-remote-3-34ef7725.png\" alt=\"undefined line-numbers\" width=\"368\" height=\"515\" /></p>\r\n<p>3. &nbsp; &nbsp;打开 <strong>Proxy-&gt;Proxy Settings </strong></p>\r\n<p>4. &nbsp; &nbsp;选择Proxies选项卡，默认的HTTP Proxy的值是8888，这个端口号需要记着，后边在微信web开发者工具里边要用到的</p>\r\n<p><img src=\"https://dn-web-blued-cn.qbox.me/web/static/iliveorders/set-proxy-1-fb86e404.png\" alt=\"undefined line-numbers\" width=\"597\" height=\"446\" /></p>\r\n<p>5. &nbsp; &nbsp;选择Mac OS X选项卡，点击启用如下两个选项</p>\r\n<p><img src=\"https://dn-web-blued-cn.qbox.me/web/static/iliveorders/set-proxy-2-3cdca18b.png\" alt=\"undefined line-numbers\" width=\"594\" height=\"444\" /></p>\r\n<p>6. &nbsp; &nbsp;打开 <strong>Proxy-&gt;Mac OS X Proxy</strong> 启用本地的代理服务</p>\r\n<p><img src=\"https://dn-web-blued-cn.qbox.me/web/static/iliveorders/start-proxy-1-232db26f.png\" alt=\"undefined line-numbers\" width=\"201\" height=\"288\" /></p>\r\n<p>7. &nbsp; &nbsp;这时，Charles已经完成了本地服务代理线上服务的步骤，接下来就是微信web开发者工具中的一些设置</p>\r\n<p>8. &nbsp; &nbsp;在扫码登录后，点击右上角代理的选项</p>\r\n<p><img src=\"https://dn-web-blued-cn.qbox.me/web/static/iliveorders/set-weixin-1-44ba0339.png\" alt=\"undefined line-numbers\" width=\"454\" height=\"380\" /></p>\r\n<p>9. &nbsp; &nbsp;选择手动设置代理，然后填写本地的IP，以及前边在Charles中设置的代理端口号（第5步）</p>\r\n<p><img src=\"https://dn-web-blued-cn.qbox.me/web/static/iliveorders/set-weixin-2-2a050a13.png\" alt=\"undefined line-numbers\" width=\"467\" height=\"391\" /></p>\r\n<p>10. &nbsp;点击保存后，来到微信小程序的项目中，在wx.request中直接填写线上域名后，保存运行，你就会发现Charles中已经收到了来自你本地的一些请求😄</p>\r\n<p><img src=\"https://dn-web-blued-cn.qbox.me/web/static/iliveorders/complete-78f57c81.png\" alt=\"undefined line-numbers\" width=\"555\" height=\"431\" /></p>\r\n<p>&nbsp;</p>\r\n<p>&nbsp;</p>\r\n<h2>参考资料：</h2>\r\n<p>0. &nbsp;&nbsp;<a href=\"https://mp.weixin.qq.com/debug/wxadoc/dev/?t=20161107\">微信小程序官方文档</a></p>\r\n<p>1. &nbsp;&nbsp;<a href=\"http://www.waitsun.com/charles-3-11-2.html\">Charles破解版安装</a></p>\r\n<p>&nbsp;</p>\r\n<p>转载请署原文地址： <a href=\"https://jiasm.github.io/#/blog/36f116c0-aa64-11e6-a1ed-8fca2e8c7bc3\">https://jiasm.github.io/#/blog/36f116c0-aa64-11e6-a1ed-8fca2e8c7bc3</a></p>"
}