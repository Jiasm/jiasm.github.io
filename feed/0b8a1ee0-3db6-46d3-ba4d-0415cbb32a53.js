{
  "id": "0b8a1ee0-3db6-46d3-ba4d-0415cbb32a53",
  "title": "使用div创建选取框",
  "postDate": "2015-04-09 15:21",
  "content": "<p>使用div实现了选取框效果.</p><p>代码如下</p><pre class=\\\"language-javascript\\\"><code><span style=\\\"color: #008080;\\\">  1</span> &lt;!DOCTYPE html&gt;<span style=\\\"color: #008080;\\\">  2</span> &lt;html&gt;<span style=\\\"color: #008080;\\\">  3</span> &lt;head&gt;<span style=\\\"color: #008080;\\\">  4</span>     &lt;title&gt;myCanvasTest&lt;/title&gt;<span style=\\\"color: #008080;\\\">  5</span>     &lt;style type=\\\"text/css\\\"&gt;<span style=\\\"color: #008080;\\\">  6</span> <span style=\\\"color: #000000;\\\">        #selection{</span><span style=\\\"color: #008080;\\\">  7</span> <span style=\\\"color: #000000;\\\">            border: 3px red solid;</span><span style=\\\"color: #008080;\\\">  8</span> <span style=\\\"color: #000000;\\\">            display: none;</span><span style=\\\"color: #008080;\\\">  9</span> <span style=\\\"color: #000000;\\\">            position: absolute;</span><span style=\\\"color: #008080;\\\"> 10</span> <span style=\\\"color: #000000;\\\">        }</span><span style=\\\"color: #008080;\\\"> 11</span>         *<span style=\\\"color: #000000;\\\">{</span><span style=\\\"color: #008080;\\\"> 12</span> <span style=\\\"color: #000000;\\\">            cursor: crosshair;</span><span style=\\\"color: #008080;\\\"> 13</span> <span style=\\\"color: #000000;\\\">        }</span><span style=\\\"color: #008080;\\\"> 14</span>     &lt;/style&gt;<span style=\\\"color: #008080;\\\"> 15</span> &lt;/head&gt;<span style=\\\"color: #008080;\\\"> 16</span> &lt;body&gt;<span style=\\\"color: #008080;\\\"> 17</span>     &lt;div id=\\\"selection\\\"&gt;&lt;/div&gt;<span style=\\\"color: #008080;\\\"> 18</span> &lt;/body&gt;<span style=\\\"color: #008080;\\\"> 19</span> &lt;script type=\\\"text/javascript\\\"&gt;<span style=\\\"color: #008080;\\\"> 20</span>     <span style=\\\"color: #0000ff;\\\">var</span> selection,                                                    <span style=\\\"color: #008000;\\\">\\/\\/</span><span style=\\\"color: #008000;\\\">存储坐标量(方便用)</span><span style=\\\"color: #008080;\\\"> 21</span>         flag             = <span style=\\\"color: #0000ff;\\\">false</span>,                                    <span style=\\\"color: #008000;\\\">\\/\\/</span><span style=\\\"color: #008000;\\\">作为是否在鼠标点击时的移动标记</span><span style=\\\"color: #008080;\\\"> 22</span>         selectionDiv     = document.getElementById(\\\"selection\\\");        <span style=\\\"color: #008000;\\\">\\/\\/</span><span style=\\\"color: #008000;\\\">获取选取框div对象</span><span style=\\\"color: #008080;\\\"> 23</span> <span style=\\\"color: #008080;\\\"> 24</span>     <span style=\\\"color: #008000;\\\">\\/\\/</span><span style=\\\"color: #008000;\\\">初始化坐标对象</span><span style=\\\"color: #008080;\\\"> 25</span>     <span style=\\\"color: #0000ff;\\\">function</span><span style=\\\"color: #000000;\\\"> init () {</span><span style=\\\"color: #008080;\\\"> 26</span>          selection =<span style=\\\"color: #000000;\\\"> {</span><span style=\\\"color: #008080;\\\"> 27</span>             top        :0<span style=\\\"color: #000000;\\\">,</span><span style=\\\"color: #008080;\\\"> 28</span>             left    :0<span style=\\\"color: #000000;\\\">,</span><span style=\\\"color: #008080;\\\"> 29</span>             width    :0<span style=\\\"color: #000000;\\\">,</span><span style=\\\"color: #008080;\\\"> 30</span>             height    :0<span style=\\\"color: #008080;\\\"> 31</span> <span style=\\\"color: #000000;\\\">        };</span><span style=\\\"color: #008080;\\\"> 32</span> <span style=\\\"color: #000000;\\\">    }</span><span style=\\\"color: #008080;\\\"> 33</span> <span style=\\\"color: #008080;\\\"> 34</span>     <span style=\\\"color: #008000;\\\">\\/\\/</span><span style=\\\"color: #008000;\\\">鼠标按下,记录坐标</span><span style=\\\"color: #008080;\\\"> 35</span>     <span style=\\\"color: #0000ff;\\\">function</span><span style=\\\"color: #000000;\\\"> setLocation (x, y) {</span><span style=\\\"color: #008080;\\\"> 36</span>         selection.left =<span style=\\\"color: #000000;\\\"> x;</span><span style=\\\"color: #008080;\\\"> 37</span>         selection.top =<span style=\\\"color: #000000;\\\"> y;</span><span style=\\\"color: #008080;\\\"> 38</span> <span style=\\\"color: #000000;\\\">    }</span><span style=\\\"color: #008080;\\\"> 39</span> <span style=\\\"color: #008080;\\\"> 40</span>     <span style=\\\"color: #008000;\\\">\\/\\/</span><span style=\\\"color: #008000;\\\">鼠标移动计算距离存入宽高</span><span style=\\\"color: #008080;\\\"> 41</span>     <span style=\\\"color: #0000ff;\\\">function</span><span style=\\\"color: #000000;\\\"> moveLocation (x, y) {</span><span style=\\\"color: #008080;\\\"> 42</span>         selection.width = selection.left -<span style=\\\"color: #000000;\\\"> x;</span><span style=\\\"color: #008080;\\\"> 43</span>         selection.height = selection.top -<span style=\\\"color: #000000;\\\"> y;</span><span style=\\\"color: #008080;\\\"> 44</span> <span style=\\\"color: #000000;\\\">        moveIt();                </span><span style=\\\"color: #008080;\\\"> 45</span> <span style=\\\"color: #000000;\\\">    }</span><span style=\\\"color: #008080;\\\"> 46</span> <span style=\\\"color: #008080;\\\"> 47</span>     <span style=\\\"color: #008000;\\\">\\/\\/</span><span style=\\\"color: #008000;\\\">更新div坐标尺寸信息</span><span style=\\\"color: #008080;\\\"> 48</span>     <span style=\\\"color: #0000ff;\\\">function</span><span style=\\\"color: #000000;\\\"> moveIt () {</span><span style=\\\"color: #008080;\\\"> 49</span> <span style=\\\"color: #000000;\\\">        console.log(selection);</span><span style=\\\"color: #008080;\\\"> 50</span>         <span style=\\\"color: #008000;\\\">\\/\\/</span><span style=\\\"color: #008000;\\\">高度宽度小于0时说明拖拽x,y为正值,如小于0说明拖动为反方向.需重新计算top及left保证拖拽效果</span><span style=\\\"color: #008080;\\\"> 51</span>         selectionDiv.style.top         = (selection.height &lt; 0 ? <span style=\\\"color: #008080;\\\"> 52</span> <span style=\\\"color: #000000;\\\">                                        selection.top :                     </span><span style=\\\"color: #008080;\\\"> 53</span>                                         selection.top -<span style=\\\"color: #000000;\\\"> selection.height) </span><span style=\\\"color: #008080;\\\"> 54</span>                                     + \\\"px\\\"<span style=\\\"color: #000000;\\\">;</span><span style=\\\"color: #008080;\\\"> 55</span>         selectionDiv.style.left     = (selection.width &lt; 0 ? <span style=\\\"color: #008080;\\\"> 56</span> <span style=\\\"color: #000000;\\\">                                        selection.left : </span><span style=\\\"color: #008080;\\\"> 57</span>                                         selection.left -<span style=\\\"color: #000000;\\\"> selection.width) </span><span style=\\\"color: #008080;\\\"> 58</span>                                     + \\\"px\\\"<span style=\\\"color: #000000;\\\">;</span><span style=\\\"color: #008080;\\\"> 59</span>         <span style=\\\"color: #008000;\\\">\\/\\/</span><span style=\\\"color: #008000;\\\">Math.abs()方法返回绝对值</span><span style=\\\"color: #008080;\\\"> 60</span>         selectionDiv.style.width     =<span style=\\\"color: #000000;\\\"> Math.abs(selection.width) </span><span style=\\\"color: #008080;\\\"> 61</span>                                     + \\\"px\\\"<span style=\\\"color: #000000;\\\">;</span><span style=\\\"color: #008080;\\\"> 62</span>         selectionDiv.style.height     =<span style=\\\"color: #000000;\\\"> Math.abs(selection.height) </span><span style=\\\"color: #008080;\\\"> 63</span>                                     + \\\"px\\\"<span style=\\\"color: #000000;\\\">;</span><span style=\\\"color: #008080;\\\"> 64</span> <span style=\\\"color: #000000;\\\">    }</span><span style=\\\"color: #008080;\\\"> 65</span> <span style=\\\"color: #008080;\\\"> 66</span>     <span style=\\\"color: #008000;\\\">\\/\\/</span><span style=\\\"color: #008000;\\\">显示选取框div</span><span style=\\\"color: #008080;\\\"> 67</span>     <span style=\\\"color: #0000ff;\\\">function</span><span style=\\\"color: #000000;\\\"> showIt () {</span><span style=\\\"color: #008080;\\\"> 68</span>         selectionDiv.style.display = \\\"block\\\"<span style=\\\"color: #000000;\\\">;</span><span style=\\\"color: #008080;\\\"> 69</span> <span style=\\\"color: #000000;\\\">    }</span><span style=\\\"color: #008080;\\\"> 70</span> <span style=\\\"color: #008080;\\\"> 71</span>     <span style=\\\"color: #008000;\\\">\\/\\/</span><span style=\\\"color: #008000;\\\">隐藏选取框div</span><span style=\\\"color: #008080;\\\"> 72</span>     <span style=\\\"color: #0000ff;\\\">function</span><span style=\\\"color: #000000;\\\"> hideIt () {</span><span style=\\\"color: #008080;\\\"> 73</span>         selectionDiv.style.display = \\\"none\\\"<span style=\\\"color: #000000;\\\">;</span><span style=\\\"color: #008080;\\\"> 74</span> <span style=\\\"color: #000000;\\\">    }</span><span style=\\\"color: #008080;\\\"> 75</span> <span style=\\\"color: #008080;\\\"> 76</span>     <span style=\\\"color: #008000;\\\">\\/\\/</span><span style=\\\"color: #008000;\\\">鼠标按下触发事件</span><span style=\\\"color: #008080;\\\"> 77</span>     window.onmousedown = <span style=\\\"color: #0000ff;\\\">function</span><span style=\\\"color: #000000;\\\"> (e) {</span><span style=\\\"color: #008080;\\\"> 78</span>         <span style=\\\"color: #0000ff;\\\">var</span> x =<span style=\\\"color: #000000;\\\"> e.clientX,</span><span style=\\\"color: #008080;\\\"> 79</span>             y =<span style=\\\"color: #000000;\\\"> e.clientY;</span><span style=\\\"color: #008080;\\\"> 80</span>         <span style=\\\"color: #008000;\\\">\\/\\/</span><span style=\\\"color: #008000;\\\">初始化坐标对象</span><span style=\\\"color: #008080;\\\"> 81</span> <span style=\\\"color: #000000;\\\">        init();</span><span style=\\\"color: #008080;\\\"> 82</span>         <span style=\\\"color: #008000;\\\">\\/\\/</span><span style=\\\"color: #008000;\\\">显示div对象</span><span style=\\\"color: #008080;\\\"> 83</span> <span style=\\\"color: #000000;\\\">        showIt();</span><span style=\\\"color: #008080;\\\"> 84</span>         <span style=\\\"color: #008000;\\\">\\/\\/</span><span style=\\\"color: #008000;\\\">设置top,left值.作为本次拖拽的原点</span><span style=\\\"color: #008080;\\\"> 85</span> <span style=\\\"color: #000000;\\\">        setLocation(x, y);</span><span style=\\\"color: #008080;\\\"> 86</span>         <span style=\\\"color: #008000;\\\">\\/\\/</span><span style=\\\"color: #008000;\\\">调用移动方法</span><span style=\\\"color: #008080;\\\"> 87</span> <span style=\\\"color: #000000;\\\">        moveIt();</span><span style=\\\"color: #008080;\\\"> 88</span>         <span style=\\\"color: #008000;\\\">\\/\\/</span><span style=\\\"color: #008000;\\\">将标记打开</span><span style=\\\"color: #008080;\\\"> 89</span>         flag = <span style=\\\"color: #0000ff;\\\">true</span><span style=\\\"color: #000000;\\\">;</span><span style=\\\"color: #008080;\\\"> 90</span> <span style=\\\"color: #000000;\\\">    }</span><span style=\\\"color: #008080;\\\"> 91</span> <span style=\\\"color: #008080;\\\"> 92</span>     <span style=\\\"color: #008000;\\\">\\/\\/</span><span style=\\\"color: #008000;\\\">鼠标移动时触发</span><span style=\\\"color: #008080;\\\"> 93</span>     window.onmousemove = <span style=\\\"color: #0000ff;\\\">function</span><span style=\\\"color: #000000;\\\"> (e) {</span><span style=\\\"color: #008080;\\\"> 94</span>         <span style=\\\"color: #0000ff;\\\">var</span> x =<span style=\\\"color: #000000;\\\"> e.clientX,</span><span style=\\\"color: #008080;\\\"> 95</span>             y =<span style=\\\"color: #000000;\\\"> e.clientY;</span><span style=\\\"color: #008080;\\\"> 96</span>         <span style=\\\"color: #008000;\\\">\\/\\/</span><span style=\\\"color: #008000;\\\">当标记开启时,触发事件</span><span style=\\\"color: #008080;\\\"> 97</span>         <span style=\\\"color: #0000ff;\\\">if</span><span style=\\\"color: #000000;\\\">(flag)</span><span style=\\\"color: #008080;\\\"> 98</span> <span style=\\\"color: #000000;\\\">            moveLocation(x, y);</span><span style=\\\"color: #008080;\\\"> 99</span> <span style=\\\"color: #000000;\\\">    }</span><span style=\\\"color: #008080;\\\">100</span> <span style=\\\"color: #008080;\\\">101</span>     <span style=\\\"color: #008000;\\\">\\/\\/</span><span style=\\\"color: #008000;\\\">鼠标抬起,触发事件,将div隐藏,清除坐标对象,关闭标记</span><span style=\\\"color: #008080;\\\">102</span>     window.onmouseup = <span style=\\\"color: #0000ff;\\\">function</span><span style=\\\"color: #000000;\\\"> (e) {</span><span style=\\\"color: #008080;\\\">103</span>         <span style=\\\"color: #008000;\\\">\\/\\/</span><span style=\\\"color: #008000;\\\">隐藏div</span><span style=\\\"color: #008080;\\\">104</span> <span style=\\\"color: #000000;\\\">        hideIt();</span><span style=\\\"color: #008080;\\\">105</span>         <span style=\\\"color: #008000;\\\">\\/\\/</span><span style=\\\"color: #008000;\\\">清除坐标信息</span><span style=\\\"color: #008080;\\\">106</span> <span style=\\\"color: #000000;\\\">        init();</span><span style=\\\"color: #008080;\\\">107</span>         <span style=\\\"color: #008000;\\\">\\/\\/</span><span style=\\\"color: #008000;\\\">关闭标记</span><span style=\\\"color: #008080;\\\">108</span>         flag = <span style=\\\"color: #0000ff;\\\">false</span><span style=\\\"color: #000000;\\\">;</span><span style=\\\"color: #008080;\\\">109</span> <span style=\\\"color: #000000;\\\">    }</span><span style=\\\"color: #008080;\\\">110</span> <span style=\\\"color: #008080;\\\">111</span> &lt;/script&gt;<span style=\\\"color: #008080;\\\">112</span> &lt;/html&gt;</code></pre><p>感觉在编码的时候.卡在了x,y都为负值的地方.</p><p>为了保证在x,y都为负值时还有拖拽效果.必须要将div的位置移动.</p><p>看起来就像拖拽一样.实则在更新大小的同时更新了div的坐标位置</p>"
}