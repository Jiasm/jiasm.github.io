function Puzzle(t){"use strict";function r(t){for(var r=[],n=0;t>n;n++){for(var e=[],o=p[n],a=0;t>a;a++){var i=o[a],s=x*n,u=z*a,f=(t>=i?i-1:i%t!==0?i%t-1:(i-1)%t)*z,c=(t>=i?0:i%t!==0?~~(i/t):~~((i-1)/t))*x;f=-f,c=-c,e.push(I(u,s,a,n,f,c))}r.push(e)}return r}function n(t,r){G=!0,setTimeout(function(){G=!1},500);var n=r*r+"";t+="";for(var o=0;r>o;o++)for(var i=p[o],s=0,r=i.length;r>s;s++){var c=i[s];if(t===c){var d=0;return i[s-1]&&i[s-1]===n?(d=4,p[o][s-1]=t,i[s]=n):i[s+1]&&i[s+1]===n?(d=2,p[o][s+1]=t,i[s]=n):p[o-1]&&p[o-1][s]===n?(d=1,p[o-1][s]=t,i[s]=n):p[o+1]&&p[o+1][s]===n&&(d=3,p[o+1][s]=t,i[s]=n),d&&(e(d,t,o,s),l&&a()),u()&&(f("success"),k=3),1}}return 0}function e(t,r,n,e){var o=$("#item-"+r),a=S(o),i=+a[0],s=+a[1];switch(t){case 1:s-=+o.height()+h;break;case 2:i+=+o.width()+h;break;case 3:s+=+o.height()+h;break;case 4:i-=+o.width()+h}U(o,s+"px",i+"px")}function o(t){a=j.size,v=t,g=t,z=v/a-(h?h*(a+1)/a:0),x=g/a-(h?h*(a+1)/a:0),E=r(a);for(var n=0;a>n;n++)for(var e=p[n],o=0,a=e.length;a>o;o++){var i=e[o],s=E[n][o],u=$("#item-"+i).css({width:z,height:x});u&&F(u,s)}}function a(){w++,C(w)}function i(t){return C=t,j}function s(t){return O=t,j}function u(){return m===""+p}function f(t){"function"==typeof B[t]&&B[t]([].slice.call(arguments,1))}function c(){return k}var p,d,m,l,h,v,g,z,x,b,k,w,y,T,C,O,P,F,r,I,S,U,E,G,M=$(t),j=this,q="ontouchstart"in document,A=q?"touchstart":"click",B=["","start","pause","over","proceed","","success"],D=function(t){function e(t,r){t.css({overflow:"hidden"}).css(r.bar).append($("<img>",{src:H}).css(r.img))}function o(t,r){t.css({"background-size":v+"px "+g+"px","background-image":"url("+H+")"}).css(r)}function a(t,r,n,e,o,a){return{bar:{left:t+h*(1+n),top:r+h*(1+e)},img:{width:v,height:g,position:"absolute",top:a,left:o}}}function i(t,r,n,e,o,a){return{transform:"translate3d("+(t+h*(1+n))+"px, "+(r+h*(1+e))+"px, 0)","-webkit-transform":"translate3d("+(t+h*(1+n))+"px, "+(r+h*(1+e))+"px, 0)","-ms-transform":"translate3d("+(t+h*(1+n))+"px, "+(r+h*(1+e))+"px, 0)","-o-transform":"translate3d("+(t+h*(1+n))+"px, "+(r+h*(1+e))+"px, 0)","background-position-x":o,"background-position-y":a}}function s(t){return[parseFloat(t.css("left")),parseFloat(t.css("top"))]}function u(t){var r=t[0].style;return(r.transform||r.webkitTransform||r.mozTransform||r.msTransform||r.oTransform).replace("translate3d","").match(/\d+(\.\d+)?/g)}function c(t,r,n){t.animate({top:r,left:n},500)}function C(t,r,n){t.css({transform:"translate3d("+n+", "+r+", 0)","-webkit-transform":"translate3d("+n+", "+r+", 0)","-ms-transform":"translate3d("+n+", "+r+", 0)","-o-transform":"translate3d("+n+", "+r+", 0)"})}function q(){function t(){return~~(Math.random()*n)+1}function r(t){return-1!==N(e,t)}m=[];for(var n=R*R,e=[],o=0;n>o;o++){for(var a;a=t(),r(a););e.push(a)}for(var i=[],s=0,u=0;R>s;s++){for(var f=[],c=0;R>c;c++)f.push(""+e[u++]),m.push(""+u);i.push(f)}return m=""+m,m===""+i?q(R):i}function B(t){var r,n,e,o=[];for(n=0,e=t.length;e>n;n++)r=t[n],o.push("string"==typeof r?r:B(r));return o}function D(){y=0,P&&clearInterval(P),P=setInterval(function(){1===k&&(y++,O(y))},1e3)}var H="string"==typeof t?t:t.imgSrc;if(!H)return 0;M.html(""),T=t,R=t.size||3,l=t.record,h=t.gap||0,w=0,y=0,p=t.data||q(),d=B(p),k=t.autoplay?1:3,v=M.width(),g=M.height(),z=v/R-(h?h*(R+1)/R:0),x=g/R-(h?h*(R+1)/R:0),b=L("transform")&&L("background-position-x")&&L("transition")&&L("background-size"),F=b?o:e,I=b?i:a,S=b?u:s,U=b?C:c,E=r(R),j.size=R;for(var J=0;R>J;J++)for(var K=p[J],Q=0,R=K.length;R>Q;Q++){var V=K[Q],W=E[J][Q],X=$("<div>",{id:"item-"+V,"data-index":V,"class":"puzzle-item"}).css({width:z,height:x,position:"absolute"});F(X,W),M.append(X)}return $('.puzzle-item[data-index="'+R*R+'"]').remove(),b?$(".puzzle-item").on(A+".move",function(){1===k&&n($(this).data("index"),R)}):$(".puzzle-item img").on(A+".move",function(){1!==k||G||n($(this).parent().data("index"),R)}),t.autoplay&&f("start"),t.timing&&D(),j},H=function(t){var r=T;if("string"!=typeof r){for(var n in t)r[n]=t[n];delete r.data}return D(r)},J=function(){var t=T;for(var r in T)t[r]=T[r];return t.data=d,D(t)},K=function(t){var r;return(r=k!==t)&&(k=t),r},L=function(t){var r,n=["webkit","moz","ms","o"],e=[],o=document.documentElement.style,a=function(t){return t.replace(/-(\w)/g,function(t,r){return r.toUpperCase()})};for(r in n)e.push(a(n[r]+"-"+t));e.push(a(t));for(r in e)if(e[r]in o)return!0;return!1},N=[].indexOf?function(t,r){return t.indexOf(r)}:function(t,r){for(var n=t.length-1;n>=0;n--)if(t[n]===r)return n;return-1};j.init=D,j.update=H,j.restart=J,j.step=i,j.timer=s,j.resize=o,j.getGameStatus=c;for(var Q=0,R=B.length;R>Q;Q++){var V;if(V=B[Q]){var W="game"+V.substring(0,1).toUpperCase()+V.substring(1);j[W]=function(t,r){return function(){return K(t%3||3)&&f(r),j}}(Q,V),j[V]=function(t){return function(r){return B[t]=r,j}}(V)}}Puzzle.prototype.supportCss=L,Puzzle.prototype.indexOf=N}